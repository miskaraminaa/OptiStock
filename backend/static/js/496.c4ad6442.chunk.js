"use strict";(self.webpackChunkadmin_dashboard_template_OptiStock=self.webpackChunkadmin_dashboard_template_OptiStock||[]).push([[496],{5176:(e,s,t)=>{t.d(s,{Z:()=>l});var a=t(184);const r=function(e){let{styleClass:s,children:t}=e;return(0,a.jsx)("div",{className:"text-xl font-semibold ".concat(s),children:t})};const l=function(e){let{title:s,children:t,topMargin:l,TopSideButtons:i}=e;return(0,a.jsxs)("div",{className:"card w-full p-6 bg-base-100 shadow-xl "+(l||"mt-6"),children:[(0,a.jsxs)(r,{styleClass:i?"inline-block":"",children:[s,i&&(0,a.jsx)("div",{className:"inline-block float-right",children:i})]}),(0,a.jsx)("div",{className:"divider mt-2"}),(0,a.jsx)("div",{className:"h-full w-full pb-6 bg-base-100",children:t})]})}},5870:(e,s,t)=>{t.r(s),t.d(s,{default:()=>u});var a=t(1413),r=t(2791),l=t(7848),i=t(1989),c=t(7689),n=t(9434),o=t(5054),d=(t(5176),t(184));const u=()=>{const[e,s]=(0,r.useState)([]),[t,u]=(0,r.useState)("LE"),[m,h]=(0,r.useState)(""),[p,x]=(0,r.useState)(!0),v=((0,c.s0)(),(0,n.I0)());(0,r.useEffect)((()=>{v((0,o.Iw)({title:"T\xe9l\xe9versement Fichiers SAP"}))}),[v]);const f=[{value:"LE",label:"LE - Statut Livraisons Entrantes"},{value:"LET",label:"LET - T\xe2ches Livraisons Entrantes"},{value:"LS",label:"LS - Statut Livraisons Sortantes"},{value:"LST",label:"LST - T\xe2ches Livraisons Sortantes"},{value:"MB51",label:"MB51 - Mouvements SAP"},{value:"STOCK_EWM",label:"STOCK_EWM"},{value:"STOCK_IAM",label:"STOCK_IAM"}],g="http://localhost:5000",b=(0,r.useCallback)((async()=>{try{const e=await i.Z.get("".concat(g,"/uploads/files"));console.log("R\xe9ponse fichiers import\xe9s:",e.data),s(e.data.files)}catch(a){var e,t;console.error("Erreur lors de la r\xe9cup\xe9ration des fichiers import\xe9s:",{message:a.message,status:null===(e=a.response)||void 0===e?void 0:e.status,data:null===(t=a.response)||void 0===t?void 0:t.data}),h("\xc9chec du chargement des fichiers import\xe9s.")}}),[]);(0,r.useEffect)((()=>{(async()=>{await b(),x(!1)})()}),[b]);const j=(0,r.useCallback)((async e=>{h("T\xe9l\xe9versement en cours...");const s=e.map((async e=>{const s=new FormData;s.append("file",e),s.append("type",t);try{const t=await i.Z.post("".concat(g,"/uploads"),s,{headers:{"Content-Type":"multipart/form-data"}});return console.log("R\xe9ponse t\xe9l\xe9versement:",t.data),{status:"success",message:t.data.message,fileName:e.name}}catch(n){var a,r,l,c;return console.error("Erreur t\xe9l\xe9versement:",{message:n.message,status:null===(a=n.response)||void 0===a?void 0:a.status,data:null===(r=n.response)||void 0===r?void 0:r.data}),{status:"failed",error:(null===(l=n.response)||void 0===l||null===(c=l.data)||void 0===c?void 0:c.message)||"\xc9chec du t\xe9l\xe9versement",fileName:e.name}}}));try{const e=await Promise.all(s);await b();const t=e.every((e=>"success"===e.status)),a=e.every((e=>"failed"===e.status));h(t?"T\xe9l\xe9versement r\xe9ussi pour tous les fichiers !":a?"\xc9chec du t\xe9l\xe9versement de tous les fichiers !":"Certains fichiers ont \xe9t\xe9 t\xe9l\xe9vers\xe9s avec succ\xe8s, d'autres ont \xe9chou\xe9.");const r=e.filter((e=>"failed"===e.status));r.length>0&&(console.log("Fichiers \xe9chou\xe9s:",r),h((e=>e+"\nErreurs : "+r.map((e=>"".concat(e.fileName,": ").concat(e.error))).join(", "))))}catch(a){h("Erreur lors du traitement des fichiers : ".concat(a.message))}}),[t,b]),{getRootProps:y,getInputProps:N,isDragActive:w}=(0,l.uI)({onDrop:j,accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"]}}),S=e.reduce(((e,s)=>(e[s.type]=e[s.type]||[],e[s.type].push(s),e)),{});return p?(0,d.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,d.jsx)("p",{className:"text-xl text-gray-600",children:"Chargement..."})}):(0,d.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-gray-100 min-h-screen",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"T\xe9l\xe9versement Fichiers SAP"}),(0,d.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"S\xe9lectionner le Type de Fichier"}),(0,d.jsx)("select",{value:t,onChange:e=>u(e.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:f.map((e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,d.jsxs)("div",(0,a.Z)((0,a.Z)({},y()),{},{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer ".concat(w?"border-indigo-500 bg-indigo-50":"border-gray-300"),children:[(0,d.jsx)("input",(0,a.Z)({},N())),(0,d.jsx)("p",{className:"text-gray-600",children:w?"D\xe9posez les fichiers Excel ici...":"Glissez et d\xe9posez les fichiers Excel ici, ou cliquez pour s\xe9lectionner"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"(fichiers .xlsx, .xls uniquement)"})]})),m&&(0,d.jsx)("p",{className:"mt-4 text-center ".concat(m.includes("r\xe9ussi")?"text-green-600":m.includes("\xc9chec")||m.includes("Erreur")?"text-red-600":"text-yellow-600"),children:m})]}),(0,d.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Fichiers Import\xe9s"}),0===Object.keys(S).length?(0,d.jsx)("p",{className:"text-gray-500 text-center",children:"Aucun fichier import\xe9 pour le moment."}):Object.keys(S).map((e=>{var s;return(0,d.jsxs)("div",{className:"mb-6",children:[(0,d.jsxs)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:["Type : ",(null===(s=f.find((s=>s.value===e)))||void 0===s?void 0:s.label)||e]}),(0,d.jsx)("ul",{className:"divide-y divide-gray-200",children:S[e].map((e=>(0,d.jsxs)("li",{className:"py-2 flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-700",children:e.fichier_name}),(0,d.jsxs)("span",{className:"ml-2 text-sm ".concat("imported"===e.status?"text-green-600":"partial"===e.status?"text-yellow-600":"text-red-600"),children:["(","imported"===e.status?"Import\xe9":"partial"===e.status?"Partiel":"\xc9chou\xe9",")"]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsx)("div",{className:"text-gray-500 text-sm",children:new Date(e.import_date).toLocaleString("fr-FR")}),(0,d.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer ce fichier et ses donn\xe9es associ\xe9es ? Cette action est irr\xe9versible."))try{await i.Z.delete("".concat(g,"/uploads/files/").concat(e)),await b(),h("Fichier et donn\xe9es associ\xe9es supprim\xe9s avec succ\xe8s.")}catch(s){console.error("Erreur lors de la suppression du fichier:",s),h("\xc9chec de la suppression du fichier.")}})(e.id),className:"px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Supprimer"})]})]},e.id)))})]},e)}))]})]})}},9496:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(2791),r=t(9434),l=t(5054),i=t(5870),c=t(184);const n=function(){return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"mt-2",children:(0,c.jsx)(i.default,{})})})};const o=function(){const e=(0,r.I0)();return(0,a.useEffect)((()=>{e((0,l.Iw)({title:"Dashboard"}))}),[]),(0,c.jsx)(n,{})}}}]);
//# sourceMappingURL=496.c4ad6442.chunk.js.map