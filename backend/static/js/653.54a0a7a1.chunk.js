"use strict";(self.webpackChunkadmin_OptiStock=self.webpackChunkadmin_OptiStock||[]).push([[653],{5176:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(184);const r=function(e){let{styleClass:t,children:a}=e;return(0,n.jsx)("div",{className:"text-xl font-semibold ".concat(t),children:a})};const s=function(e){let{title:t,children:a,topMargin:s,TopSideButtons:l}=e;return(0,n.jsxs)("div",{className:"card w-full p-6 bg-base-100 shadow-xl "+(s||"mt-6"),children:[(0,n.jsxs)(r,{styleClass:l?"inline-block":"",children:[t,l&&(0,n.jsx)("div",{className:"inline-block float-right",children:l})]}),(0,n.jsx)("div",{className:"divider mt-2"}),(0,n.jsx)("div",{className:"h-full w-full pb-6 bg-base-100",children:a})]})}},653:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var n=a(2791),r=a(9434),s=a(5054),l=a(1413),o=a(5176),i=a(5987);const d=["title","titleId"];function c(e,t){let{title:a,titleId:r}=e,s=(0,i.Z)(e,d);return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},s),a?n.createElement("title",{id:r},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const u=n.forwardRef(c);var m=a(2426),p=a.n(m),h=a(4045),g=a(184);const v=()=>{(0,r.I0)();const[e,t]=(0,n.useState)([]),[a,s]=(0,n.useState)(""),[i,d]=(0,n.useState)("LE"),[c,m]=(0,n.useState)([]),[v,x]=(0,n.useState)([]),[b,y]=(0,n.useState)({status:"",deliveryCode:"",articleCode:""}),[_,j]=(0,n.useState)(new Set),[N,k]=(0,n.useState)(!1),[C,f]=(0,n.useState)(!1),[Z,w]=(0,n.useState)(null),[S,E]=(0,n.useState)(!1),[L,P]=(0,n.useState)({}),Q="http://localhost:5000";(0,n.useEffect)((()=>{i&&(async()=>{k(!0),w(null),t([]),s("");const e="".concat(Q,"/livraison/files");console.log("R\xe9cup\xe9ration des fichiers depuis : ".concat(e," avec le type : ").concat(i));try{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:i})});if(!a.ok){const e=await a.text();throw new Error("Erreur HTTP ! statut : ".concat(a.status,", message : ").concat(e))}const n=await a.json();t(n.files||[]),0===n.files.length&&w("Aucun fichier disponible pour le type ".concat(i,"."))}catch(a){console.error("Erreur lors de la r\xe9cup\xe9ration des fichiers :",a),w("\xc9chec du chargement des noms de fichiers : ".concat(a.message))}finally{k(!1)}})()}),[Q,i]),(0,n.useEffect)((()=>{const e=e=>{let t=[...e];if(b.articleCode&&(t=t.filter((e=>{var t;return null===(t=e.Produit)||void 0===t?void 0:t.toString().toLowerCase().includes(b.articleCode.toLowerCase())}))),b.deliveryCode&&(t=t.filter((e=>{var t;return null===(t=e.Document)||void 0===t?void 0:t.toString().toLowerCase().includes(b.deliveryCode.toLowerCase())}))),b.status&&"Tous les statuts"!==b.status){const e=b.status.toLowerCase();t=t.filter((t=>{var a;const n=(null===(a=t.statut_entree_stock)||void 0===a?void 0:a.toLowerCase())||"";return console.log("Comparaison statut : item=".concat(n,", filtre=").concat(e)),"non termin\xe9e"===e?"termin\xe9e"!==n:n===e}))}console.log("Donn\xe9es apr\xe8s filtrage :",t),x(t)};a&&i?(async()=>{f(!0),w(null);const t="".concat(Q,"/livraison/process"),n={type:i,fileName:a,value:b.articleCode||"",stock:b.status||"Tous les statuts"};console.log("R\xe9cup\xe9ration des donn\xe9es depuis : ".concat(t," avec les donn\xe9es :"),n);try{const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const e=await a.text();throw new Error("Erreur HTTP ! statut : ".concat(a.status,", message : ").concat(e))}const r=await a.json();console.log("Donn\xe9es brutes re\xe7ues du backend :",r);const s=r.map((e=>(0,l.Z)((0,l.Z)({},e),{},{statut_entree_stock:e.statut_entree_stock?e.statut_entree_stock.trim().toLowerCase():"non termin\xe9e"})));m(s),e(s)}catch(r){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es :",r),w("\xc9chec du chargement des donn\xe9es : ".concat(r.message))}finally{f(!1)}})():(m([]),x([]),!a&&i&&w("Veuillez s\xe9lectionner un fichier pour charger les donn\xe9es."))}),[a,b,Q,i]);const T=e=>{if("add"===e&&L){const e=(0,l.Z)((0,l.Z)({},L),{},{Document:L.Document||"LIV".concat(p()().format("YYYYMMDDHHmmss")),Statut_tache_magasin:L.Statut_tache_magasin||"Non termin\xe9e",statut_entree_stock:L.statut_entree_stock||"Non termin\xe9e"});"LE"===i&&(e.longueur=L.longueur||"100",e.largeur=L.largeur||"50",e.hauteur=L.hauteur||"20",e.volume=L.volume||"100000",e.poids=L.poids||"10",e.Quantite=L.Quantite||"100",e.poids_global=L.poids_global||"1000",e.volume_quantite=L.volume_quantite||"1000",e.manutention=L.manutention||"Manuel",e.Type_Rayon=L.Type_Rayon||"Standard"),L.Qte_theo_ced_UQA&&L.quantit&&(e.quantite_ecart=(parseFloat(L.Qte_theo_ced_UQA)-parseFloat(L.quantit)).toString());const t=[...v,e];x(t),E(!1),P({})}else if("remove"===e&&_.size>0){const e=[...v];Array.from(_).sort(((e,t)=>t-e)).forEach((t=>e.splice(t,1))),j(new Set),x(e)}},A="LE"===i?[{header:"N\xb0 LE",key:"Document"},{header:"Statut T\xe2che Magasin",key:"Statut_tache_magasin"},{header:"Produit",key:"Produit"},{header:"D\xe9signation Article",key:"designation_article"},{header:"Longueur",key:"longueur"},{header:"Largeur",key:"largeur"},{header:"Hauteur",key:"hauteur"},{header:"Volume",key:"volume"},{header:"Poids",key:"poids"},{header:"Quantit\xe9",key:"Quantite"},{header:"Poids Global",key:"poids_global"},{header:"Volume/Quantit\xe9",key:"volume_quantite"},{header:"Manutention",key:"manutention"},{header:"Type Rayon",key:"Type_Rayon"},{header:"Emplacement C\xe9dant",key:"emplacement_cedant"},{header:"Emplacement Prenant",key:"Emplacement_prenant"},{header:"Qte Th\xe9o C\xe9d UQA",key:"Qte_theo_ced_UQA"},{header:"Statut Activit\xe9 Magasin",key:"statut_entree_stock"}]:[{header:"N\xb0 LS",key:"Document"},{header:"Statut",key:"Statut_tache_magasin"},{header:"Produit",key:"Produit"},{header:"D\xe9signation",key:"designation_article"},{header:"Emplacement C\xe9dant",key:"Emplacement_cedant"},{header:"Emplacement Prenant",key:"Emplacement_prenant"},{header:"Qte Th\xe9o C\xe9d UQA",key:"Qte_theo_ced_UQA"},{header:"Quantit\xe9",key:"quantit"},{header:"Statut Activit\xe9 Magasin",key:"statut_entree_stock"}];return(0,g.jsx)(o.Z,{title:"Livraison",children:(0,g.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,g.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,g.jsxs)("select",{value:i,onChange:e=>{d(e.target.value),s(""),t([]),w(null),E(!1),P({})},className:"p-2 border rounded",children:[(0,g.jsx)("option",{value:"LE",children:"Livraison Entrante (LE)"}),(0,g.jsx)("option",{value:"LS",children:"Livraison Sortante (LS)"})]}),(0,g.jsxs)("select",{value:a,onChange:e=>{s(e.target.value),w(null),E(!1),P({})},className:"p-2 border rounded",disabled:N,children:[(0,g.jsx)("option",{value:"",children:N?"Chargement des fichiers...":"S\xe9lectionner un fichier"}),e.map((e=>(0,g.jsx)("option",{value:e,children:e},e)))]}),(0,g.jsx)("select",{value:b.status,onChange:e=>y((0,l.Z)((0,l.Z)({},b),{},{status:e.target.value})),className:"p-2 border rounded",children:[{value:"Tous les statuts",label:"Tous les statuts"},{value:"Termin\xe9e",label:"Termin\xe9e"},{value:"Non termin\xe9e",label:"Non termin\xe9e"}].map((e=>(0,g.jsx)("option",{value:e.value,children:e.label},e.value)))}),(0,g.jsx)("input",{type:"text",placeholder:"N\xb0 Livraison (LE/LS)",value:b.deliveryCode,onChange:e=>y((0,l.Z)((0,l.Z)({},b),{},{deliveryCode:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"text",placeholder:"Code article",value:b.articleCode,onChange:e=>y((0,l.Z)((0,l.Z)({},b),{},{articleCode:e.target.value})),className:"p-2 border rounded"})]}),(Z||N||C)&&(0,g.jsxs)("div",{className:"mb-4",children:[N&&(0,g.jsx)("div",{className:"text-blue-500",children:"Chargement des fichiers..."}),C&&(0,g.jsx)("div",{className:"text-blue-500",children:"Chargement des donn\xe9es..."}),Z&&(0,g.jsx)("div",{className:"text-red-500",children:Z})]}),(0,g.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,g.jsx)("button",{onClick:()=>E(!S),className:"bg-blue-500 text-white p-2 rounded hover:bg-blue-600",disabled:!a||C,children:S?"Annuler":"Ajouter"}),(0,g.jsx)("button",{onClick:()=>T("remove"),className:"bg-red-500 text-white p-2 rounded hover:bg-red-600",disabled:0===_.size||C,children:"Retirer"}),(0,g.jsx)("button",{onClick:()=>{const e=h.P6.json_to_sheet(v),t=h.P6.book_new();h.P6.book_append_sheet(t,e,"Livraisons"),h.NC(t,"livraison_".concat(p()().format("YYYYMMDD_HHmmss"),".xlsx"))},className:"bg-green-500 text-white p-2 rounded hover:bg-green-600",disabled:C,children:"Exporter Excel"}),(0,g.jsx)("button",{onClick:()=>{const e=document.getElementById("livraison-table").outerHTML,t=window.open("","_blank");t.document.write("\n            <html>\n                <head><title>Imprimer Livraison</title></head>\n                <body>".concat(e,"</body>\n            </html>\n        ")),t.document.close(),t.print()},className:"bg-yellow-500 text-white p-2 rounded hover:bg-yellow-600",disabled:C,children:"Imprimer"})]}),S&&(0,g.jsxs)("div",{className:"mb-4 p-4 border rounded bg-gray-50",children:[(0,g.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Ajouter un nouvel article"}),(0,g.jsxs)("form",{onSubmit:e=>{e.preventDefault(),T("add")},className:"grid grid-cols-2 gap-4",children:[(0,g.jsx)("input",{type:"text",placeholder:"Document",value:L.Document||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Document:e.target.value})),className:"p-2 border rounded",required:!0}),(0,g.jsx)("input",{type:"text",placeholder:"Produit",value:L.Produit||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Produit:e.target.value})),className:"p-2 border rounded",required:!0}),(0,g.jsx)("input",{type:"text",placeholder:"D\xe9signation Article",value:L.designation_article||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{designation_article:e.target.value})),className:"p-2 border rounded"}),"LE"===i&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("input",{type:"number",placeholder:"Longueur",value:L.longueur||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{longueur:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Largeur",value:L.largeur||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{largeur:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Hauteur",value:L.hauteur||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{hauteur:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Volume",value:L.volume||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{volume:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Poids",value:L.poids||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{poids:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Quantit\xe9",value:L.Quantite||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Quantite:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Poids Global",value:L.poids_global||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{poids_global:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Volume/Quantit\xe9",value:L.volume_quantite||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{volume_quantite:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"text",placeholder:"Manutention",value:L.manutention||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{manutention:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"text",placeholder:"Type Rayon",value:L.Type_Rayon||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Type_Rayon:e.target.value})),className:"p-2 border rounded"})]}),(0,g.jsx)("input",{type:"text",placeholder:"Emplacement C\xe9dant",value:L.emplacement_cedant||L.Emplacement_cedant||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{["LE"===i?"emplacement_cedant":"Emplacement_cedant"]:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"text",placeholder:"Emplacement Prenant",value:L.Emplacement_prenant||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Emplacement_prenant:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"text",placeholder:"Emplacement EWM/Qte",value:L.Emplacement_EWM_Qte||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Emplacement_EWM_Qte:e.target.value})),className:"p-2 border rounded"}),(0,g.jsx)("input",{type:"number",placeholder:"Qte Th\xe9o C\xe9d UQA",value:L.Qte_theo_ced_UQA||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Qte_theo_ced_UQA:e.target.value})),className:"p-2 border rounded",required:!0}),(0,g.jsx)("input",{type:"number",placeholder:"Quantit\xe9",value:L.quantit||"",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{quantit:e.target.value})),className:"p-2 border rounded",required:!0}),(0,g.jsx)("input",{type:"text",placeholder:"Qt\xe9 \xc9cart",value:L.quantite_ecart||"",readOnly:!0,className:"p-2 border rounded bg-gray-100"}),(0,g.jsxs)("select",{value:L.Statut_tache_magasin||"Non termin\xe9e",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{Statut_tache_magasin:e.target.value})),className:"p-2 border rounded",children:[(0,g.jsx)("option",{value:"Non termin\xe9e",children:"Non termin\xe9e"}),(0,g.jsx)("option",{value:"Termin\xe9e",children:"Termin\xe9e"}),(0,g.jsx)("option",{value:"Partiellement termin\xe9e",children:"Partiellement termin\xe9e"}),(0,g.jsx)("option",{value:"Pas commenc\xe9e",children:"Pas commenc\xe9e"}),(0,g.jsx)("option",{value:"Pas pertinente",children:"Pas pertinente"})]}),(0,g.jsxs)("select",{value:L.statut_entree_stock||"Non termin\xe9e",onChange:e=>P((0,l.Z)((0,l.Z)({},L),{},{statut_entree_stock:e.target.value})),className:"p-2 border rounded",children:[(0,g.jsx)("option",{value:"Non termin\xe9e",children:"Non termin\xe9e"}),(0,g.jsx)("option",{value:"Termin\xe9e",children:"Termin\xe9e"}),(0,g.jsx)("option",{value:"Partiellement termin\xe9e",children:"Partiellement termin\xe9e"}),(0,g.jsx)("option",{value:"Pas commenc\xe9e",children:"Pas commenc\xe9e"}),(0,g.jsx)("option",{value:"Pas pertinente",children:"Pas pertinente"})]}),(0,g.jsx)("button",{type:"submit",className:"col-span-2 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",disabled:C,children:"Ajouter l'article"})]})]}),(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)("table",{id:"livraison-table",className:"w-full text-sm text-left text-gray-500",children:[(0,g.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{className:"px-4 py-2",children:(0,g.jsx)("input",{type:"checkbox",onChange:e=>j(e.target.checked?new Set(v.map(((e,t)=>t))):new Set),disabled:C})}),A.map((e=>(0,g.jsx)("th",{className:"px-4 py-2",style:e.style||{},children:e.header},e.key))),(0,g.jsx)("th",{className:"px-4 py-2",children:"Actions"})]})}),(0,g.jsx)("tbody",{children:0===v.length?(0,g.jsx)("tr",{children:(0,g.jsx)("td",{colSpan:A.length+2,className:"px-4 py-2 text-center text-gray-500",children:"Aucune donn\xe9e disponible pour les filtres s\xe9lectionn\xe9s."})}):v.map(((e,t)=>(0,g.jsxs)("tr",{className:"".concat(_.has(t)?"bg-gray-100":""," border-b hover:bg-gray-50"),children:[(0,g.jsx)("td",{className:"px-4 py-2",children:(0,g.jsx)("input",{type:"checkbox",checked:_.has(t),onChange:()=>(e=>{const t=new Set(_);t.has(e)?t.delete(e):t.add(e),j(t)})(t),disabled:C})}),A.map((t=>(0,g.jsx)("td",{className:"px-4 py-2",style:t.style||{},children:void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:""},t.key))),(0,g.jsx)("td",{className:"px-4 py-2",children:(0,g.jsx)("button",{onClick:()=>(e=>{const t=[...v];t.splice(e,1),x(t),j(new Set)})(t),className:"text-red-500 hover:text-red-700",disabled:C,children:(0,g.jsx)(u,{className:"h-5 w-5"})})})]},t)))})]})})]})})};const x=function(){const e=(0,r.I0)();return(0,n.useEffect)((()=>{e((0,s.Iw)({title:"Livraisons LE - LS"}))}),[]),(0,g.jsx)(v,{})}}}]);
//# sourceMappingURL=653.54a0a7a1.chunk.js.map