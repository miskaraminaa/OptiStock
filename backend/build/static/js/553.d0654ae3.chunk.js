"use strict";(self.webpackChunkadmin_OptiStock=self.webpackChunkadmin_OptiStock||[]).push([[553],{5176:(e,t,a)=>{a.d(t,{Z:()=>n});var r=a(184);const o=function(e){let{styleClass:t,children:a}=e;return(0,r.jsx)("div",{className:"text-xl font-semibold ".concat(t),children:a})};const n=function(e){let{title:t,children:a,topMargin:n,TopSideButtons:s}=e;return(0,r.jsxs)("div",{className:"card w-full p-6 bg-base-100 shadow-xl "+(n||"mt-6"),children:[(0,r.jsxs)(o,{styleClass:s?"inline-block":"",children:[t,s&&(0,r.jsx)("div",{className:"inline-block float-right",children:s})]}),(0,r.jsx)("div",{className:"divider mt-2"}),(0,r.jsx)("div",{className:"h-full w-full pb-6 bg-base-100",children:a})]})}},7553:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var r=a(1413),o=a(2791),n=a(9434),s=a(2694),l=a(6564),i=a(3071),c=a(2426),d=a.n(c),u=a(4045),m=a(5054),h=a(5176),p=a(184);const g=()=>{var e;const t=(0,n.I0)(),[a,c]=(0,o.useState)([]),[g,b]=(0,o.useState)([]),[x,y]=(0,o.useState)({nOt:"",bs:"",typeSortie:"",dateLivraison:""}),[f,v]=(0,o.useState)(new Set),[w,j]=(0,o.useState)(!1),[_,N]=(0,o.useState)(!1),[k,S]=(0,o.useState)(null),[E,L]=(0,o.useState)(!1),[C,M]=(0,o.useState)({type_sortie:"OT",nature_sortie:"normal",magasin:"Magasin",articles:[],date_livraison:d()().format("YYYY-MM-DD")}),[Y,O]=(0,o.useState)([]),[A,T]=(0,o.useState)(""),Z="http://localhost:5000",D=[{header:"Date Livraison",key:"date_livraison"},{header:"N\xb0 OT",key:"n_ot"},{header:"N\xb0 BS",key:"bs"},{header:"N\xb0 LE",key:"le"},{header:"N\xb0 STO",key:"commande_achat"},{header:"Nature de sortie",key:"nature_sortie"},{header:"Type de sortie",key:"type_sortie"},{header:"N\xb0 R\xe9servation",key:"n_reservation"},{header:"Magasin",key:"magasin"},{header:"Local",key:"local"},{header:"Demandeur",key:"demandeur"},{header:"Pr\xe9parateur",key:"preparateur"},{header:"Responsable local",key:"responsable_local"},{header:"Articles",key:"articles"}],q=[{header:"Article",key:"article"},{header:"D\xe9signation",key:"designation_article"},{header:"Stock Initial",key:"stock_initial"},{header:"Sorties",key:"sorties"},{header:"Entr\xe9es",key:"entrees"},{header:"Quantit\xe9 Contr\xf4le",key:"stock_quantite_controle"},{header:"Quantit\xe9 IAM",key:"quantite_iam"},{header:"Validation",key:"validation"}],P=[{value:"OT",label:"OT"},{value:"BS",label:"BS"},{value:"LE",label:"LE"},{value:"STO",label:"STO"}],I={Magasin:[{value:"MSLE",label:"MSLE/MSLT - BOUZIT LAHSSAN",responsable:"BOUZIT LAHSSAN"},{value:"MSLV",label:"MSLV/MSRL/MSGP/MSLL/MSPC/DSED - BENDADA MOHAMMED",responsable:"BENDADA MOHAMMED"}],"Magasin EPI":[{value:"MSFE",label:"MSFE - BOUALLAK NOURDINE",responsable:"BOUALLAK NOURDINE"}],"Parc Exterieur":[{value:"PEXT",label:"PEXT/el kouhail abdelmajid",responsable:"el kouhail abdelmajid"}]},B={Magasin:"JAMAL RHENNAOUI","Magasin EPI":"ELBAHI AMINE","Parc Exterieur":"SARGALI YOUSSEF"};(0,o.useEffect)((()=>{t((0,m.Iw)({title:"Contr\xf4le Livraison"}))}),[t]);const H=async()=>{j(!0),S(null);try{const e=await fetch("".concat(Z,"/controle/data"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!e.ok)throw new Error("Erreur HTTP ! Statut : ".concat(e.status));const t=(await e.json()).map((e=>(0,r.Z)((0,r.Z)({},e),{},{n_ot:e.n_ot?e.n_ot.trim().toLowerCase():"",bs:e.bs?e.bs.trim().toLowerCase():"",le:e.le?e.le.trim().toLowerCase():"",commande_achat:e.commande_achat?e.commande_achat.trim():"",nature_sortie:e.nature_sortie?e.nature_sortie.trim():"",type_sortie:e.type_sortie?e.type_sortie.trim():"",n_reservation:e.n_reservation?e.n_reservation.trim():"",magasin:e.magasin?e.magasin.trim():"",local:e.local?e.local.trim():"",demandeur:e.demandeur?e.demandeur.trim():"",preparateur:e.preparateur?e.preparateur.trim():"",responsable_local:e.responsable_local?e.responsable_local.trim():"",articles:Array.isArray(e.articles)?e.articles:"string"===typeof e.articles?JSON.parse(e.articles||"[]"):[],date_livraison:e.date_livraison||"N/V"})));c(t),z(t)}catch(e){S("\xc9chec du chargement des donn\xe9es : ".concat(e.message)),console.error("[Controle] Erreur data:",e)}finally{j(!1)}};(0,o.useEffect)((()=>{H(),(async()=>{j(!0),S(null);try{const e=await fetch("".concat(Z,"/controle/mb51/articles"));if(!e.ok)throw new Error("Erreur HTTP ! Statut : ".concat(e.status));const t=await e.json();O(t.map((e=>(0,r.Z)((0,r.Z)({},e),{},{stock_quantite_controle:parseFloat(e.stock_quantite_controle)||0})))),0===t.length&&S("Aucun article trouv\xe9 dans la r\xe9ponse de l'API.")}catch(e){S("\xc9chec du chargement des articles : ".concat(e.message)),console.error("[Controle] Erreur articles:",e)}finally{j(!1)}})()}),[x]);const z=e=>{let t=[...e];x.nOt&&(t=t.filter((e=>{var t;return null===(t=e.n_ot)||void 0===t?void 0:t.toLowerCase().includes(x.nOt.toLowerCase())}))),x.bs&&(t=t.filter((e=>{var t;return null===(t=e.bs)||void 0===t?void 0:t.toLowerCase().includes(x.bs.toLowerCase())}))),x.typeSortie&&(t=t.filter((e=>e.type_sortie===x.typeSortie))),x.dateLivraison&&(t=t.filter((e=>e.date_livraison===x.dateLivraison))),b(t)},R=async e=>{try{if("add"===e&&C){var t;if(!C.articles||0===C.articles.length)throw new Error("Au moins un article doit \xeatre fourni.");if(!C.date_livraison)throw new Error("La date de livraison est requise.");for(const t of C.articles){if(!t.article||t.quantity<=0)throw new Error("L'article ".concat(t.article||"inconnu"," doit avoir une quantit\xe9 positive."));const e=Y.find((e=>e.article===t.article));if(!e)throw new Error("L'article ".concat(t.article," n'est pas disponible dans le stock."));if(t.quantity>e.stock_quantite_controle)throw new Error("Quantit\xe9 pour ".concat(t.article," d\xe9passe la quantit\xe9 contr\xf4le (").concat(e.stock_quantite_controle,")."))}const e=null===(t=I[C.magasin])||void 0===t?void 0:t.find((e=>e.value===C.local));let{n_ot:a="",bs:o="",le:n="",commande_achat:s=""}=C;if("OT"!==C.type_sortie||a&&""!==a.trim()||(a="OT".concat(d()().format("YYYYMMDDHHmmss"))),"BS"!==C.type_sortie||o&&""!==o.trim()||(o="BS".concat(d()().format("YYYYMMDDHHmmss"))),"LE"!==C.type_sortie||n&&""!==n.trim()||(n="LE".concat(d()().format("YYYYMMDDHHmmss"))),"STO"!==C.type_sortie||s&&""!==s.trim()||(s="STO".concat(d()().format("YYYYMMDDHHmmss"))),"OT"===C.type_sortie&&!a)throw new Error("Le N\xb0 OT est requis pour un type de sortie OT.");if("BS"===C.type_sortie&&!o)throw new Error("Le BS est requis pour un type de sortie BS.");if("LE"===C.type_sortie&&!n)throw new Error("Le LE est requis pour un type de sortie LE.");if("STO"===C.type_sortie&&!s)throw new Error("La commande d'achat est requise pour un type de sortie STO.");const l=(0,r.Z)((0,r.Z)({},C),{},{n_ot:a,bs:o,le:n,commande_achat:s,responsable_local:(null===e||void 0===e?void 0:e.responsable)||C.responsable_local||"",magasin:C.magasin||"Magasin",date_livraison:C.date_livraison,articles:C.articles.map((e=>({article:e.article,designation_article:e.designation_article,quantity:parseFloat(e.quantity)||0,quantite_mise_a_jour:e.quantite_mise_a_jour||0})))});j(!0);const i=await fetch("".concat(Z,"/controle/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",data:l})});if(!i.ok){const e=await i.json();throw new Error(e.error||"Erreur lors de l'ajout")}L(!1),M({type_sortie:"OT",nature_sortie:"normal",magasin:"Magasin",articles:[],date_livraison:d()().format("YYYY-MM-DD")}),T(""),S(null),await H()}else{if(!("remove"===e&&f.size>0))throw new Error("Aucune action valide ou aucun \xe9l\xe9ment s\xe9lectionn\xe9.");{const e=Array.from(f).map((e=>{const t=g[e];if(!t)return null;let a;switch(t.type_sortie){case"OT":a=t.n_ot;break;case"BS":a=t.bs;break;case"LE":a=t.le;break;case"STO":a=t.commande_achat;break;default:return null}return a&&""!==a.trim()?{type_sortie:t.type_sortie,identifier:a}:null})).filter((e=>null!==e));if(0===e.length)throw new Error("Aucun identifiant valide s\xe9lectionn\xe9 pour la suppression.");N(!0);const t=await fetch("".concat(Z,"/controle/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remove",data:e})});if(!t.ok){const e=await t.json();throw new Error(e.error||"Erreur lors de la suppression")}v(new Set),S(null),await H()}}}catch(a){S("\xc9chec de la mise \xe0 jour : ".concat(a.message)),console.error("[Controle] Erreur update:",a)}finally{N(!1),j(!1)}},V=Y.filter((e=>{var t,a;return(null===(t=e.article)||void 0===t?void 0:t.toLowerCase().includes(A.toLowerCase()))||(null===(a=e.designation_article)||void 0===a?void 0:a.toLowerCase().includes(A.toLowerCase()))}));return(0,p.jsx)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:(0,p.jsx)(h.Z,{title:"Contr\xf4le Livraison",children:(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 OT",value:x.nOt,onChange:e=>y((0,r.Z)((0,r.Z)({},x),{},{nOt:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full sm:w-48"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 BS",value:x.bs,onChange:e=>y((0,r.Z)((0,r.Z)({},x),{},{bs:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full sm:w-48"}),(0,p.jsxs)("select",{value:x.typeSortie,onChange:e=>y((0,r.Z)((0,r.Z)({},x),{},{typeSortie:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full sm:w-48",children:[(0,p.jsx)("option",{value:"",children:"Tous les types"}),P.map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value)))]}),(0,p.jsx)("input",{type:"date",value:x.dateLivraison,onChange:e=>y((0,r.Z)((0,r.Z)({},x),{},{dateLivraison:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full sm:w-48"})]}),(w||_||k)&&(0,p.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(w||_)&&(0,p.jsx)(l.Z,{color:"#3b82f6",size:20}),(w||_)&&(0,p.jsx)("span",{className:"text-gray-600",children:_?"Suppression en cours...":"Chargement des donn\xe9es..."}),k&&(0,p.jsxs)("span",{className:"text-red-600",children:["\u26a0\ufe0f ",k]})]}),(0,p.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,p.jsx)("button",{onClick:()=>L(!E),className:"px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-all duration-200 text-sm font-medium",disabled:w||_,children:E?"Annuler":"Ajouter"}),(0,p.jsx)("button",{onClick:()=>R("remove"),className:"px-4 py-2 bg-red-600 text-white rounded-lg shadow hover:bg-red-700 transition-all duration-200 text-sm font-medium",disabled:0===f.size||w||_,children:"Retirer"}),(0,p.jsx)("button",{onClick:()=>{const e=u.P6.json_to_sheet(g.map((e=>(0,r.Z)((0,r.Z)({},e),{},{articles:Array.isArray(e.articles)?e.articles.map((e=>"".concat(e.article," (").concat(e.quantity,")"))).join(", "):"",date_livraison:e.date_livraison&&"N/V"!==e.date_livraison?d()(e.date_livraison).format("DD/MM/YYYY"):"N/V"})))),t=u.P6.book_new();u.P6.book_append_sheet(t,e,"Controle Livraisons"),u.NC(t,"controle_livraisons_".concat(x.dateLivraison||d()().format("YYYYMMDD"),".xlsx"))},className:"px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-all duration-200 text-sm font-medium",disabled:w||_,children:"Exporter Livraisons"}),(0,p.jsx)("button",{onClick:()=>{const e=u.P6.json_to_sheet(Y),t=u.P6.book_new();u.P6.book_append_sheet(t,e,"Stock Control"),u.NC(t,"stock_control_".concat(d()().format("YYYYMMDD"),".xlsx"))},className:"px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-all duration-200 text-sm font-medium",disabled:w||_,children:"Exporter Stock"}),(0,p.jsx)("button",{onClick:()=>{const e=window.open("","_blank"),t="\n            <html>\n                <head>\n                    <title>Contr\xf4le Livraisons - ".concat(x.dateLivraison||d()().format("DD/MM/YYYY"),"</title>\n                    <style>\n                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n                        body { font-family: 'Inter', sans-serif; margin: 20px; color: #1f2937; }\n                        h1 { text-align: center; font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; }\n                        h2 { font-size: 1.125rem; font-weight: 600; margin: 1.5rem 0 0.5rem; }\n                        p { text-align: center; font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem; }\n                        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; margin-bottom: 1.25rem; }\n                        th, td { border: 1px solid #e5e7eb; padding: 0.5rem; text-align: left; }\n                        th { background-color: #f3f4f6; font-weight: 600; text-transform: uppercase; }\n                        tr:nth-child(even) { background-color: #f9fafb; }\n                        .no-data { text-align: center; padding: 1.25rem; font-style: italic; color: #6b7280; }\n                    </style>\n                </head>\n                <body>\n                    <h1>Contr\xf4le Livraisons</h1>\n                    <p>Imprim\xe9 le ").concat(d()().format("DD/MM/YYYY HH:mm")," pour la date ").concat(x.dateLivraison?d()(x.dateLivraison).format("DD/MM/YYYY"):"Toutes","</p>\n                    <h2>Livraisons</h2>\n                    <table>\n                        <thead>\n                            <tr>").concat(D.map((e=>"<th>".concat(e.header,"</th>"))).join(""),"</tr>\n                        </thead>\n                        <tbody>\n                            ").concat(0===g.length?'<tr><td colspan="'.concat(D.length,'" class="no-data">Aucune donn\xe9e disponible pour les filtres s\xe9lectionn\xe9s.</td></tr>'):g.map((e=>"\n                                        <tr>\n                                            ".concat(D.map((t=>"\n                                                <td>\n                                                    ".concat("articles"===t.key&&e[t.key]?Array.isArray(e.articles)?e.articles.map((e=>"".concat(e.article," (").concat(e.quantity,")"))).join(", "):"":"date_livraison"===t.key&&"N/V"!==e[t.key]?d()(e[t.key]).format("DD/MM/YYYY"):e[t.key]||"","\n                                                </td>\n                                            "))).join(""),"\n                                        </tr>\n                                    "))).join(""),"\n                        </tbody>\n                    </table>\n                </body>\n            </html>\n        ");e.document.write(t),e.document.close(),e.print()},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg shadow hover:bg-yellow-700 transition-all duration-200 text-sm font-medium",disabled:w||_,children:"Imprimer Livraisons"}),(0,p.jsx)("button",{onClick:()=>{const e=window.open("","_blank"),t="\n            <html>\n                <head>\n                    <title>Stock Control - ".concat(d()().format("DD/MM/YYYY"),"</title>\n                    <style>\n                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n                        body { font-family: 'Inter', sans-serif; margin: 20px; color: #1f2937; }\n                        h1 { text-align: center; font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; }\n                        h2 { font-size: 1.125rem; font-weight: 600; margin: 1.5rem 0 0.5rem; }\n                        p { text-align: center; font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem; }\n                        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; margin-bottom: 1.25rem; }\n                        th, td { border: 1px solid #e5e7eb; padding: 0.5rem; text-align: left; }\n                        th { background-color: #f3f4f6; font-weight: 600; text-transform: uppercase; }\n                        tr:nth-child(even) { background-color: #f9fafb; }\n                        .no-data { text-align: center; padding: 1.25rem; font-style: italic; color: #6b7280; }\n                        .validation-non-valide { color: #dc2626; font-weight: 600; }\n                    </style>\n                </head>\n                <body>\n                    <h1>Stock Control</h1>\n                    <p>Imprim\xe9 le ").concat(d()().format("DD/MM/YYYY HH:mm"),"</p>\n                    <h2>Stock Control</h2>\n                    <table>\n                        <thead>\n                            <tr>").concat(q.map((e=>"<th>".concat(e.header,"</th>"))).join(""),"</tr>\n                        </thead>\n                        <tbody>\n                            ").concat(0===Y.length?'<tr><td colspan="'.concat(q.length,'" class="no-data">Aucun article disponible.</td></tr>'):Y.map((e=>"\n                                        <tr>\n                                            ".concat(q.map((t=>'\n                                                <td class="'.concat("validation"===t.key&&"Valid\xe9"!==e[t.key]?"validation-non-valide":"",'">\n                                                    ').concat(void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:"","\n                                                </td>\n                                            "))).join(""),"\n                                        </tr>\n                                    "))).join(""),"\n                        </tbody>\n                    </table>\n                </body>\n            </html>\n        ");e.document.write(t),e.document.close(),e.print()},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg shadow hover:bg-yellow-700 transition-all duration-200 text-sm font-medium",disabled:w||_,children:"Imprimer Stock"})]}),E&&(0,p.jsxs)(s.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3},className:"p-6 bg-white shadow-lg rounded-lg",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Ajouter une nouvelle livraison"}),(0,p.jsxs)("form",{onSubmit:e=>{e.preventDefault(),R("add")},className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de livraison"}),(0,p.jsx)("input",{type:"date",value:C.date_livraison,onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{date_livraison:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type de sortie"}),(0,p.jsx)("select",{value:C.type_sortie,onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{type_sortie:e.target.value,n_ot:"",bs:"",le:"",commande_achat:""})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",children:P.map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),"OT"===C.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 OT"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 OT",value:C.n_ot||"",onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{n_ot:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),"BS"===C.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 BS"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 BS",value:C.bs||"",onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{bs:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),"LE"===C.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 LE"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 LE",value:C.le||"",onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{le:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),"STO"===C.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 STO"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 STO",value:C.commande_achat||"",onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{commande_achat:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nature de sortie"}),(0,p.jsx)("select",{value:C.nature_sortie,onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{nature_sortie:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",children:[{value:"urgent",label:"Urgent"},{value:"normal",label:"Normal"},{value:"session",label:"Session"}].map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 R\xe9servation"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 R\xe9servation",value:C.n_reservation||"",onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{n_reservation:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin"}),(0,p.jsx)("select",{value:C.magasin,onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{magasin:e.target.value,local:"",responsable_local:""})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",children:[{value:"Magasin",label:"Magasin"},{value:"Magasin EPI",label:"Magasin EPI"},{value:"Parc Exterieur",label:"Parc Exterieur"}].map((e=>(0,p.jsxs)("option",{value:e.value,children:[e.label," - ",B[e.value]]},e.value)))})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Local"}),(0,p.jsxs)("select",{value:C.local,onChange:e=>{var t;const a=null===(t=I[C.magasin])||void 0===t?void 0:t.find((t=>t.value===e.target.value));M((0,r.Z)((0,r.Z)({},C),{},{local:e.target.value,responsable_local:(null===a||void 0===a?void 0:a.responsable)||""}))},className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",disabled:!C.magasin,children:[(0,p.jsx)("option",{value:"",children:"S\xe9lectionner un local"}),C.magasin&&(null===(e=I[C.magasin])||void 0===e?void 0:e.map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value))))]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Demandeur"}),(0,p.jsx)("input",{type:"text",placeholder:"Demandeur",value:C.demandeur||"",onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{demandeur:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pr\xe9parateur"}),(0,p.jsx)("input",{type:"text",placeholder:"Pr\xe9parateur",value:C.preparateur||"",onChange:e=>M((0,r.Z)((0,r.Z)({},C),{},{preparateur:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsable local"}),(0,p.jsx)("input",{type:"text",placeholder:"Responsable local",value:C.responsable_local||"",readOnly:!0,className:"p-2.5 border border-gray-300 rounded-lg shadow-sm bg-gray-100 text-sm w-full"})]}),(0,p.jsxs)("div",{className:"col-span-1 sm:col-span-2",children:[(0,p.jsx)("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:"Ajouter des articles"}),(0,p.jsxs)("div",{className:"flex flex-col gap-2 mb-2",children:[(0,p.jsx)("input",{type:"text",placeholder:"Filtrer par code ou d\xe9signation",value:A,onChange:e=>T(e.target.value),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full"}),(0,p.jsxs)("select",{onChange:e=>{const[t,a]=e.target.value.split(" - ");t&&a&&((e,t)=>{Y.length?C.articles.some((t=>t.article===e))||(M((a=>(0,r.Z)((0,r.Z)({},a),{},{articles:[...a.articles,{article:e,designation_article:t,quantity:0,quantite_mise_a_jour:0}]}))),S(null)):S("Les articles ne sont pas encore charg\xe9s. Veuillez r\xe9essayer.")})(t,a),e.target.value=""},className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",disabled:0===Y.length,children:[(0,p.jsx)("option",{value:"",children:"S\xe9lectionner un article"}),V.length>0?V.map((e=>(0,p.jsxs)("option",{value:"".concat(e.article," - ").concat(e.designation_article),children:[e.article," - ",e.designation_article," (Quantit\xe9 Contr\xf4le: ",e.stock_quantite_controle||0,")"]},e.article))):(0,p.jsx)("option",{disabled:!0,children:"Aucun article correspondant"})]})]}),C.articles.length>0&&(0,p.jsx)("div",{className:"mt-2 overflow-x-auto",children:(0,p.jsxs)("table",{className:"w-full text-sm border-collapse bg-white shadow-lg rounded-lg",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{className:"bg-gray-100",children:[(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Code"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"D\xe9signation"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Quantit\xe9 Contr\xf4le"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Quantit\xe9"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Quantit\xe9 Mise \xe0 Jour"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Actions"})]})}),(0,p.jsx)("tbody",{children:C.articles.map(((e,t)=>{const a=Y.find((t=>t.article===e.article));return(0,p.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:e.article}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:e.designation_article}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(null===a||void 0===a?void 0:a.stock_quantite_controle)||0}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("input",{type:"number",min:"0",step:"1",value:e.quantity,onChange:e=>((e,t)=>{const a=[...C.articles],o=parseFloat(t)||0;if(o<0)return void S("La quantit\xe9 ne peut pas \xeatre n\xe9gative.");const n=Y.find((t=>t.article===a[e].article));n&&o>n.stock_quantite_controle?S("Quantit\xe9 pour ".concat(a[e].article," d\xe9passe la quantit\xe9 contr\xf4le (").concat(n.stock_quantite_controle,")")):(a[e].quantity=o,a[e].quantite_mise_a_jour=((null===n||void 0===n?void 0:n.stock_quantite_controle)||0)-o,M((e=>(0,r.Z)((0,r.Z)({},e),{},{articles:a}))),S(null))})(t,e.target.value),className:"p-1.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-20",placeholder:"Quantit\xe9"})}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:void 0!==e.quantite_mise_a_jour?e.quantite_mise_a_jour:0}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("button",{type:"button",onClick:()=>(e=>{const t=[...C.articles];t.splice(e,1),M((e=>(0,r.Z)((0,r.Z)({},e),{},{articles:t}))),S(null)})(t),className:"text-red-600 hover:text-red-700 transition-colors duration-200",children:(0,p.jsx)(i.Xm5,{className:"h-4 w-4"})})})]},e.article)}))})]})}),0===C.articles.length&&(0,p.jsx)("p",{className:"text-gray-600 text-sm italic",children:"Aucun article s\xe9lectionn\xe9."})]}),(0,p.jsx)("button",{type:"submit",className:"col-span-1 sm:col-span-2 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-all duration-200 text-sm font-medium",disabled:w||_||0===C.articles.length,children:"Ajouter la livraison"})]})]}),(0,p.jsxs)("div",{className:"mt-6",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Livraisons"}),(0,p.jsx)("div",{className:"overflow-x-auto bg-white shadow-lg rounded-lg",children:(0,p.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{className:"bg-gray-100",children:[(0,p.jsx)("th",{className:"border border-gray-200 p-2",children:(0,p.jsx)("input",{type:"checkbox",onChange:e=>v(e.target.checked?new Set(g.map(((e,t)=>t))):new Set),disabled:w||_})}),D.map((e=>(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:e.header},e.key))),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Actions"})]})}),(0,p.jsx)("tbody",{children:0===g.length?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:D.length+2,className:"border border-gray-200 p-2 text-center text-gray-600",children:"Aucune donn\xe9e disponible pour les filtres s\xe9lectionn\xe9s."})}):g.map(((e,t)=>(0,p.jsxs)("tr",{className:"".concat(f.has(t)?"bg-gray-50":""," hover:bg-gray-50"),children:[(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("input",{type:"checkbox",checked:f.has(t),onChange:()=>(e=>{const t=new Set(f);t.has(e)?t.delete(e):t.add(e),v(t)})(t),disabled:w||_})}),D.map((t=>(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:"articles"===t.key&&e[t.key]?Array.isArray(e.articles)?e.articles.map((e=>"".concat(e.article," (").concat(e.quantity,")"))).join(", "):"":"date_livraison"===t.key&&"N/V"!==e[t.key]?d()(e[t.key]).format("DD/MM/YYYY"):e[t.key]||""},t.key))),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("button",{onClick:()=>(async e=>{try{const t=g[e];if(!t)throw new Error("Enregistrement invalide pour la suppression.");let a,r;switch(t.type_sortie){case"OT":a=t.n_ot,r="n_ot";break;case"BS":a=t.bs,r="bs";break;case"LE":a=t.le,r="le";break;case"STO":a=t.commande_achat,r="commande_achat";break;default:throw new Error("Type de sortie non reconnu: ".concat(t.type_sortie))}if(!a||""===a.trim())throw new Error("Identifiant ".concat(r," invalide pour la suppression."));N(!0);const o=await fetch("".concat(Z,"/controle/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remove",data:[{type_sortie:t.type_sortie,identifier:a}]})});if(!o.ok){const e=await o.json();throw new Error(e.error||"Erreur lors de la suppression")}S(null),await H()}catch(t){S("\xc9chec de la suppression : ".concat(t.message)),console.error("[Controle] Erreur delete:",t)}finally{N(!1)}})(t),className:"text-red-600 hover:text-red-700 transition-colors duration-200",disabled:w||_,children:(0,p.jsx)(i.Xm5,{className:"h-4 w-4"})})})]},t)))})]})})]}),(0,p.jsxs)("div",{className:"mt-6",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Stock Control"}),(0,p.jsx)("div",{className:"overflow-x-auto bg-white shadow-lg rounded-lg",children:(0,p.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,p.jsx)("thead",{children:(0,p.jsx)("tr",{className:"bg-gray-100",children:q.map((e=>(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:e.header},e.key)))})}),(0,p.jsx)("tbody",{children:0===Y.length?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:q.length,className:"border border-gray-200 p-2 text-center text-gray-600",children:"Aucun article disponible."})}):Y.map(((e,t)=>(0,p.jsx)("tr",{className:"hover:bg-gray-50",children:q.map((t=>(0,p.jsx)("td",{className:"border border-gray-200 p-2 ".concat("validation"===t.key&&"Valid\xe9"!==e[t.key]?"text-red-600 font-semibold":""),children:void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:""},t.key)))},t)))})]})})]})]})})})}}}]);
//# sourceMappingURL=553.d0654ae3.chunk.js.map