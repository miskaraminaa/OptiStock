"use strict";(self.webpackChunkadmin_dashboard_template_OptiStock=self.webpackChunkadmin_dashboard_template_OptiStock||[]).push([[77],{5176:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(184);const r=function(e){let{styleClass:t,children:a}=e;return(0,n.jsx)("div",{className:"text-xl font-semibold ".concat(t),children:a})};const s=function(e){let{title:t,children:a,topMargin:s,TopSideButtons:l}=e;return(0,n.jsxs)("div",{className:"card w-full p-6 bg-base-100 shadow-xl "+(s||"mt-6"),children:[(0,n.jsxs)(r,{styleClass:l?"inline-block":"",children:[t,l&&(0,n.jsx)("div",{className:"inline-block float-right",children:l})]}),(0,n.jsx)("div",{className:"divider mt-2"}),(0,n.jsx)("div",{className:"h-full w-full pb-6 bg-base-100",children:a})]})}},3077:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var n=a(2791),r=a(9434),s=a(5054),l=a(1413),o=a(5176),i=a(3158),d=a(2426),c=a.n(d),u=a(4045),m=a(184);const p=()=>{(0,r.I0)();const[e,t]=(0,n.useState)([]),[a,s]=(0,n.useState)(""),[d,p]=(0,n.useState)("LE"),[h,g]=(0,n.useState)([]),[v,x]=(0,n.useState)([]),[y,b]=(0,n.useState)({status:"",deliveryCode:"",articleCode:""}),[_,j]=(0,n.useState)(new Set),[N,k]=(0,n.useState)(!1),[C,f]=(0,n.useState)(!1),[Z,E]=(0,n.useState)(null),[S,w]=(0,n.useState)(!1),[Q,P]=(0,n.useState)({}),L="http://localhost:5000";(0,n.useEffect)((()=>{d&&(async()=>{k(!0),E(null),t([]),s("");const e="".concat(L,"/livraison/files");console.log("R\xe9cup\xe9ration des fichiers depuis : ".concat(e," avec le type : ").concat(d));try{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:d})});if(!a.ok){const e=await a.text();throw new Error("Erreur HTTP ! statut : ".concat(a.status,", message : ").concat(e))}const n=await a.json();t(n.files||[]),0===n.files.length&&E("Aucun fichier disponible pour le type ".concat(d,"."))}catch(a){console.error("Erreur lors de la r\xe9cup\xe9ration des fichiers :",a),E("\xc9chec du chargement des noms de fichiers : ".concat(a.message))}finally{k(!1)}})()}),[L,d]),(0,n.useEffect)((()=>{const e=e=>{let t=[...e];if(y.articleCode&&(t=t.filter((e=>{var t;return null===(t=e.Produit)||void 0===t?void 0:t.toString().toLowerCase().includes(y.articleCode.toLowerCase())}))),y.deliveryCode&&(t=t.filter((e=>{var t;return null===(t=e.Document)||void 0===t?void 0:t.toString().toLowerCase().includes(y.deliveryCode.toLowerCase())}))),y.status&&"Tous les statuts"!==y.status){const e=y.status.toLowerCase();t=t.filter((t=>{var a;const n=(null===(a=t.statut_entree_stock)||void 0===a?void 0:a.toLowerCase())||"";return console.log("Comparaison statut : item=".concat(n,", filtre=").concat(e)),"non termin\xe9e"===e?"termin\xe9e"!==n:n===e}))}console.log("Donn\xe9es apr\xe8s filtrage :",t),x(t)};a&&d?(async()=>{f(!0),E(null);const t="".concat(L,"/livraison/process"),n={type:d,fileName:a,value:y.articleCode||"",stock:y.status||"Tous les statuts"};console.log("R\xe9cup\xe9ration des donn\xe9es depuis : ".concat(t," avec les donn\xe9es :"),n);try{const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const e=await a.text();throw new Error("Erreur HTTP ! statut : ".concat(a.status,", message : ").concat(e))}const r=await a.json();console.log("Donn\xe9es brutes re\xe7ues du backend :",r);const s=r.map((e=>(0,l.Z)((0,l.Z)({},e),{},{statut_entree_stock:e.statut_entree_stock?e.statut_entree_stock.trim().toLowerCase():"non termin\xe9e"})));g(s),e(s)}catch(r){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es :",r),E("\xc9chec du chargement des donn\xe9es : ".concat(r.message))}finally{f(!1)}})():(g([]),x([]),!a&&d&&E("Veuillez s\xe9lectionner un fichier pour charger les donn\xe9es."))}),[a,y,L,d]);const T=e=>{if("add"===e&&Q){const e=(0,l.Z)((0,l.Z)({},Q),{},{Document:Q.Document||"LIV".concat(c()().format("YYYYMMDDHHmmss")),Statut_tache_magasin:Q.Statut_tache_magasin||"Non termin\xe9e",statut_entree_stock:Q.statut_entree_stock||"Non termin\xe9e"});"LE"===d&&(e.longueur=Q.longueur||"100",e.largeur=Q.largeur||"50",e.hauteur=Q.hauteur||"20",e.volume=Q.volume||"100000",e.poids=Q.poids||"10",e.Quantite=Q.Quantite||"100",e.poids_global=Q.poids_global||"1000",e.volume_quantite=Q.volume_quantite||"1000",e.manutention=Q.manutention||"Manuel",e.Type_Rayon=Q.Type_Rayon||"Standard"),Q.Qte_theo_ced_UQA&&Q.quantit&&(e.quantite_ecart=(parseFloat(Q.Qte_theo_ced_UQA)-parseFloat(Q.quantit)).toString());const t=[...v,e];x(t),w(!1),P({})}else if("remove"===e&&_.size>0){const e=[...v];Array.from(_).sort(((e,t)=>t-e)).forEach((t=>e.splice(t,1))),j(new Set),x(e)}},A="LE"===d?[{header:"N\xb0 LE",key:"Document"},{header:"Statut T\xe2che Magasin",key:"Statut_tache_magasin"},{header:"Produit",key:"Produit"},{header:"D\xe9signation Article",key:"designation_article"},{header:"Longueur",key:"longueur"},{header:"Largeur",key:"largeur"},{header:"Hauteur",key:"hauteur"},{header:"Volume",key:"volume"},{header:"Poids",key:"poids"},{header:"Quantit\xe9",key:"Quantite"},{header:"Poids Global",key:"poids_global"},{header:"Volume/Quantit\xe9",key:"volume_quantite"},{header:"Manutention",key:"manutention"},{header:"Type Rayon",key:"Type_Rayon"},{header:"Emplacement C\xe9dant",key:"emplacement_cedant"},{header:"Emplacement Prenant",key:"Emplacement_prenant"},{header:"Emplacement Final EWM/Qte",key:"Emplacement_EWM_Qte",style:{width:"200px"}},{header:"Qte Th\xe9o C\xe9d UQA",key:"Qte_theo_ced_UQA"},{header:"Qt\xe9 \xc9cart",key:"quantite_ecart"},{header:"Statut Activit\xe9 Magasin",key:"statut_entree_stock"}]:[{header:"N\xb0 LS",key:"Document"},{header:"Statut",key:"Statut_tache_magasin"},{header:"Produit",key:"Produit"},{header:"D\xe9signation",key:"designation_article"},{header:"Emplacement C\xe9dant",key:"Emplacement_cedant"},{header:"Emplacement Prenant",key:"Emplacement_prenant"},{header:"Emplacement EWM/Qte",key:"Emplacement_EWM_Qte"},{header:"Qte Th\xe9o C\xe9d UQA",key:"Qte_theo_ced_UQA"},{header:"Quantit\xe9",key:"quantit"},{header:"Qt\xe9 \xc9cart",key:"quantite_ecart"},{header:"Statut Activit\xe9 Magasin",key:"statut_entree_stock"}];return(0,m.jsx)(o.Z,{title:"Livraison",children:(0,m.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,m.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,m.jsxs)("select",{value:d,onChange:e=>{p(e.target.value),s(""),t([]),E(null),w(!1),P({})},className:"p-2 border rounded",children:[(0,m.jsx)("option",{value:"LE",children:"Livraison Entrante (LE)"}),(0,m.jsx)("option",{value:"LS",children:"Livraison Sortante (LS)"})]}),(0,m.jsxs)("select",{value:a,onChange:e=>{s(e.target.value),E(null),w(!1),P({})},className:"p-2 border rounded",disabled:N,children:[(0,m.jsx)("option",{value:"",children:N?"Chargement des fichiers...":"S\xe9lectionner un fichier"}),e.map((e=>(0,m.jsx)("option",{value:e,children:e},e)))]}),(0,m.jsx)("select",{value:y.status,onChange:e=>b((0,l.Z)((0,l.Z)({},y),{},{status:e.target.value})),className:"p-2 border rounded",children:[{value:"Tous les statuts",label:"Tous les statuts"},{value:"Termin\xe9e",label:"Termin\xe9e"},{value:"Non termin\xe9e",label:"Non termin\xe9e"}].map((e=>(0,m.jsx)("option",{value:e.value,children:e.label},e.value)))}),(0,m.jsx)("input",{type:"text",placeholder:"N\xb0 Livraison (LE/LS)",value:y.deliveryCode,onChange:e=>b((0,l.Z)((0,l.Z)({},y),{},{deliveryCode:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"text",placeholder:"Code article",value:y.articleCode,onChange:e=>b((0,l.Z)((0,l.Z)({},y),{},{articleCode:e.target.value})),className:"p-2 border rounded"})]}),(Z||N||C)&&(0,m.jsxs)("div",{className:"mb-4",children:[N&&(0,m.jsx)("div",{className:"text-blue-500",children:"Chargement des fichiers..."}),C&&(0,m.jsx)("div",{className:"text-blue-500",children:"Chargement des donn\xe9es..."}),Z&&(0,m.jsx)("div",{className:"text-red-500",children:Z})]}),(0,m.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,m.jsx)("button",{onClick:()=>w(!S),className:"bg-blue-500 text-white p-2 rounded hover:bg-blue-600",disabled:!a||C,children:S?"Annuler":"Ajouter"}),(0,m.jsx)("button",{onClick:()=>T("remove"),className:"bg-red-500 text-white p-2 rounded hover:bg-red-600",disabled:0===_.size||C,children:"Retirer"}),(0,m.jsx)("button",{onClick:()=>{const e=u.P6.json_to_sheet(v),t=u.P6.book_new();u.P6.book_append_sheet(t,e,"Livraisons"),u.NC(t,"livraison_".concat(c()().format("YYYYMMDD_HHmmss"),".xlsx"))},className:"bg-green-500 text-white p-2 rounded hover:bg-green-600",disabled:C,children:"Exporter Excel"}),(0,m.jsx)("button",{onClick:()=>{const e=document.getElementById("livraison-table").outerHTML,t=window.open("","_blank");t.document.write("\n            <html>\n                <head><title>Imprimer Livraison</title></head>\n                <body>".concat(e,"</body>\n            </html>\n        ")),t.document.close(),t.print()},className:"bg-yellow-500 text-white p-2 rounded hover:bg-yellow-600",disabled:C,children:"Imprimer"})]}),S&&(0,m.jsxs)("div",{className:"mb-4 p-4 border rounded bg-gray-50",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Ajouter un nouvel article"}),(0,m.jsxs)("form",{onSubmit:e=>{e.preventDefault(),T("add")},className:"grid grid-cols-2 gap-4",children:[(0,m.jsx)("input",{type:"text",placeholder:"Document",value:Q.Document||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Document:e.target.value})),className:"p-2 border rounded",required:!0}),(0,m.jsx)("input",{type:"text",placeholder:"Produit",value:Q.Produit||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Produit:e.target.value})),className:"p-2 border rounded",required:!0}),(0,m.jsx)("input",{type:"text",placeholder:"D\xe9signation Article",value:Q.designation_article||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{designation_article:e.target.value})),className:"p-2 border rounded"}),"LE"===d&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("input",{type:"number",placeholder:"Longueur",value:Q.longueur||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{longueur:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Largeur",value:Q.largeur||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{largeur:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Hauteur",value:Q.hauteur||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{hauteur:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Volume",value:Q.volume||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{volume:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Poids",value:Q.poids||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{poids:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Quantit\xe9",value:Q.Quantite||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Quantite:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Poids Global",value:Q.poids_global||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{poids_global:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Volume/Quantit\xe9",value:Q.volume_quantite||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{volume_quantite:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"text",placeholder:"Manutention",value:Q.manutention||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{manutention:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"text",placeholder:"Type Rayon",value:Q.Type_Rayon||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Type_Rayon:e.target.value})),className:"p-2 border rounded"})]}),(0,m.jsx)("input",{type:"text",placeholder:"Emplacement C\xe9dant",value:Q.emplacement_cedant||Q.Emplacement_cedant||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{["LE"===d?"emplacement_cedant":"Emplacement_cedant"]:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"text",placeholder:"Emplacement Prenant",value:Q.Emplacement_prenant||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Emplacement_prenant:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"text",placeholder:"Emplacement EWM/Qte",value:Q.Emplacement_EWM_Qte||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Emplacement_EWM_Qte:e.target.value})),className:"p-2 border rounded"}),(0,m.jsx)("input",{type:"number",placeholder:"Qte Th\xe9o C\xe9d UQA",value:Q.Qte_theo_ced_UQA||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Qte_theo_ced_UQA:e.target.value})),className:"p-2 border rounded",required:!0}),(0,m.jsx)("input",{type:"number",placeholder:"Quantit\xe9",value:Q.quantit||"",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{quantit:e.target.value})),className:"p-2 border rounded",required:!0}),(0,m.jsx)("input",{type:"text",placeholder:"Qt\xe9 \xc9cart",value:Q.quantite_ecart||"",readOnly:!0,className:"p-2 border rounded bg-gray-100"}),(0,m.jsxs)("select",{value:Q.Statut_tache_magasin||"Non termin\xe9e",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{Statut_tache_magasin:e.target.value})),className:"p-2 border rounded",children:[(0,m.jsx)("option",{value:"Non termin\xe9e",children:"Non termin\xe9e"}),(0,m.jsx)("option",{value:"Termin\xe9e",children:"Termin\xe9e"}),(0,m.jsx)("option",{value:"Partiellement termin\xe9e",children:"Partiellement termin\xe9e"}),(0,m.jsx)("option",{value:"Pas commenc\xe9e",children:"Pas commenc\xe9e"}),(0,m.jsx)("option",{value:"Pas pertinente",children:"Pas pertinente"})]}),(0,m.jsxs)("select",{value:Q.statut_entree_stock||"Non termin\xe9e",onChange:e=>P((0,l.Z)((0,l.Z)({},Q),{},{statut_entree_stock:e.target.value})),className:"p-2 border rounded",children:[(0,m.jsx)("option",{value:"Non termin\xe9e",children:"Non termin\xe9e"}),(0,m.jsx)("option",{value:"Termin\xe9e",children:"Termin\xe9e"}),(0,m.jsx)("option",{value:"Partiellement termin\xe9e",children:"Partiellement termin\xe9e"}),(0,m.jsx)("option",{value:"Pas commenc\xe9e",children:"Pas commenc\xe9e"}),(0,m.jsx)("option",{value:"Pas pertinente",children:"Pas pertinente"})]}),(0,m.jsx)("button",{type:"submit",className:"col-span-2 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",disabled:C,children:"Ajouter l'article"})]})]}),(0,m.jsx)("div",{className:"overflow-x-auto",children:(0,m.jsxs)("table",{id:"livraison-table",className:"w-full text-sm text-left text-gray-500",children:[(0,m.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"px-4 py-2",children:(0,m.jsx)("input",{type:"checkbox",onChange:e=>j(e.target.checked?new Set(v.map(((e,t)=>t))):new Set),disabled:C})}),A.map((e=>(0,m.jsx)("th",{className:"px-4 py-2",style:e.style||{},children:e.header},e.key))),(0,m.jsx)("th",{className:"px-4 py-2",children:"Actions"})]})}),(0,m.jsx)("tbody",{children:0===v.length?(0,m.jsx)("tr",{children:(0,m.jsx)("td",{colSpan:A.length+2,className:"px-4 py-2 text-center text-gray-500",children:"Aucune donn\xe9e disponible pour les filtres s\xe9lectionn\xe9s."})}):v.map(((e,t)=>(0,m.jsxs)("tr",{className:"".concat(_.has(t)?"bg-gray-100":""," border-b hover:bg-gray-50"),children:[(0,m.jsx)("td",{className:"px-4 py-2",children:(0,m.jsx)("input",{type:"checkbox",checked:_.has(t),onChange:()=>(e=>{const t=new Set(_);t.has(e)?t.delete(e):t.add(e),j(t)})(t),disabled:C})}),A.map((t=>(0,m.jsx)("td",{className:"px-4 py-2",style:t.style||{},children:void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:""},t.key))),(0,m.jsx)("td",{className:"px-4 py-2",children:(0,m.jsx)("button",{onClick:()=>(e=>{const t=[...v];t.splice(e,1),x(t),j(new Set)})(t),className:"text-red-500 hover:text-red-700",disabled:C,children:(0,m.jsx)(i.Z,{className:"h-5 w-5"})})})]},t)))})]})})]})})};const h=function(){const e=(0,r.I0)();return(0,n.useEffect)((()=>{e((0,s.Iw)({title:"Leads"}))}),[]),(0,m.jsx)(p,{})}}}]);
//# sourceMappingURL=77.3d36f230.chunk.js.map