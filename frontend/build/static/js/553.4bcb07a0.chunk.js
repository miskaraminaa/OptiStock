"use strict";(self.webpackChunkadmin_dashboard_template_OptiStock=self.webpackChunkadmin_dashboard_template_OptiStock||[]).push([[553],{5176:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(184);const s=function(e){let{styleClass:t,children:a}=e;return(0,r.jsx)("div",{className:"text-xl font-semibold ".concat(t),children:a})};const o=function(e){let{title:t,children:a,topMargin:o,TopSideButtons:n}=e;return(0,r.jsxs)("div",{className:"card w-full p-6 bg-base-100 shadow-xl "+(o||"mt-6"),children:[(0,r.jsxs)(s,{styleClass:n?"inline-block":"",children:[t,n&&(0,r.jsx)("div",{className:"inline-block float-right",children:n})]}),(0,r.jsx)("div",{className:"divider mt-2"}),(0,r.jsx)("div",{className:"h-full w-full pb-6 bg-base-100",children:a})]})}},7553:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var r=a(1413),s=a(2791),o=a(9434),n=a(2694),l=a(6564),i=a(3071),c=a(2426),d=a.n(c),u=a(4045),m=a(5054),h=a(5176),p=a(184);const b=()=>{var e;const t=(0,o.I0)(),[a,c]=(0,s.useState)([]),[b,g]=(0,s.useState)([]),[x,y]=(0,s.useState)({nOt:"",bs:"",typeSortie:""}),[f,v]=(0,s.useState)(new Set),[j,w]=(0,s.useState)(!1),[N,_]=(0,s.useState)(null),[k,S]=(0,s.useState)(!1),[E,C]=(0,s.useState)({type_sortie:"OT",nature_sortie:"normal",magasin:"Magasin",articles:[]}),[L,O]=(0,s.useState)([]),M="http://localhost:5000",A=[{header:"N\xb0 OT",key:"n_ot"},{header:"N\xb0 BS",key:"bs"},{header:"N\xb0 LE",key:"le"},{header:"N\xb0 STO",key:"commande_achat"},{header:"Nature de sortie",key:"nature_sortie"},{header:"Type de sortie",key:"type_sortie"},{header:"N\xb0 R\xe9servation",key:"n_reservation"},{header:"Magasin",key:"magasin"},{header:"Local",key:"local"},{header:"Demandeur",key:"demandeur"},{header:"Pr\xe9parateur",key:"preparateur"},{header:"Responsable local",key:"responsable_local"},{header:"Articles",key:"articles"}],T=[{header:"Article",key:"article"},{header:"D\xe9signation",key:"designation_article"},{header:"Stock Initial",key:"stock_initial"},{header:"Sorties",key:"sorties"},{header:"Entr\xe9es",key:"entrees"},{header:"Quantit\xe9 Contr\xf4le",key:"stock_quantite_controle"},{header:"Quantit\xe9 IAM",key:"quantite_iam"},{header:"Validation",key:"validation"}],Z=[{value:"OT",label:"OT"},{value:"BS",label:"BS"},{value:"LE",label:"LE"},{value:"STO",label:"STO"}],q={Magasin:[{value:"MSLE",label:"MSLE/MSLT - BOUZIT LAHSSAN",responsable:"BOUZIT LAHSSAN"},{value:"MSLV",label:"MSLV/MSRL/MSGP/MSLL/MSPC/DSED - BENDADA MOHAMMED",responsable:"BENDADA MOHAMMED"}],"Magasin EPI":[{value:"MSFE",label:"MSFE - BOUALLAK NOURDINE",responsable:"BOUALLAK NOURDINE"}],"Parc Exterieur":[{value:"PEXT",label:"PEXT/el kouhail abdelmajid",responsable:"el kouhail abdelmajid"}]},D={Magasin:"JAMAL RHENNAOUI","Magasin EPI":"ELBAHI AMINE","Parc Exterieur":"SARGALI YOUSSEF"};(0,s.useEffect)((()=>{t((0,m.Iw)({title:"Contr\xf4le Livraison"}))}),[t]);const Y=async()=>{w(!0),_(null);try{const e=await fetch("".concat(M,"/controle/data"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!e.ok)throw new Error("Erreur HTTP ! statut : ".concat(e.status));const t=(await e.json()).map((e=>(0,r.Z)((0,r.Z)({},e),{},{n_ot:e.n_ot?e.n_ot.trim().toLowerCase():"",bs:e.bs?e.bs.trim().toLowerCase():"",le:e.le?e.le.trim().toLowerCase():"",commande_achat:e.commande_achat?e.commande_achat.trim():"",nature_sortie:e.nature_sortie?e.nature_sortie.trim():"",type_sortie:e.type_sortie?e.type_sortie.trim().toLowerCase():"",n_reservation:e.n_reservation?e.n_reservation.trim():"",magasin:e.magasin?e.magasin.trim():"",local:e.local?e.local.trim():"",demandeur:e.demandeur?e.demandeur.trim():"",preparateur:e.preparateur?e.preparateur.trim():"",responsable_local:e.responsable_local?e.responsable_local.trim():"",articles:"string"===typeof e.articles?JSON.parse(e.articles||"[]"):e.articles||[]})));c(t),P(t)}catch(e){_("\xc9chec du chargement des donn\xe9es : ".concat(e.message)),console.error("[Controle] Erreur data:",e)}finally{w(!1)}};(0,s.useEffect)((()=>{Y(),(async()=>{try{const e=await fetch("".concat(M,"/controle/mb51/articles"));if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));const t=await e.json();O(t)}catch(e){_("\xc9chec du chargement des articles : ".concat(e.message)),console.error("[Controle] Erreur articles:",e)}})()}),[x]);const P=e=>{let t=[...e];x.nOt&&(t=t.filter((e=>{var t;return null===(t=e.n_ot)||void 0===t?void 0:t.toLowerCase().includes(x.nOt.toLowerCase())}))),x.bs&&(t=t.filter((e=>{var t;return null===(t=e.bs)||void 0===t?void 0:t.toLowerCase().includes(x.bs.toLowerCase())}))),x.typeSortie&&(t=t.filter((e=>{var t;return(null===(t=e.type_sortie)||void 0===t?void 0:t.toLowerCase())===x.typeSortie.toLowerCase()}))),g(t)},H=async e=>{try{if("add"===e&&E){var t;if(!E.articles||0===E.articles.length)throw new Error("Au moins un article doit \xeatre fourni.");for(const t of E.articles){if(!t.article||t.quantity<=0)throw new Error("L'article ".concat(t.article||"inconnu"," doit avoir une quantit\xe9 positive."));const e=L.find((e=>e.article===t.article));if(e&&t.quantity>e.stock_quantite_controle)throw new Error("Quantit\xe9 pour ".concat(t.article," d\xe9passe la quantit\xe9 contr\xf4le (").concat(e.stock_quantite_controle,")."))}const e=null===(t=q[E.magasin])||void 0===t?void 0:t.find((e=>e.value===E.local));let{n_ot:a="",bs:s="",le:o="",commande_achat:n=""}=E;if("OT"!==E.type_sortie||a&&""!==a.trim()||(a="OT".concat(d()().format("YYYYMMDDHHmmss"))),"BS"!==E.type_sortie||s&&""!==s.trim()||(s="BS".concat(d()().format("YYYYMMDDHHmmss"))),"LE"!==E.type_sortie||o&&""!==o.trim()||(o="LE".concat(d()().format("YYYYMMDDHHmmss"))),"STO"!==E.type_sortie||n&&""!==n.trim()||(n="STO".concat(d()().format("YYYYMMDDHHmmss"))),"OT"===E.type_sortie&&!a)throw new Error("Le N\xb0 OT est requis pour un type de sortie OT.");if("BS"===E.type_sortie&&!s)throw new Error("Le BS est requis pour un type de sortie BS.");if("LE"===E.type_sortie&&!o)throw new Error("Le LE est requis pour un type de sortie LE.");if("STO"===E.type_sortie&&!n)throw new Error("La commande d'achat est requise pour un type de sortie STO.");const l=(0,r.Z)((0,r.Z)({},E),{},{n_ot:a,bs:s,le:o,commande_achat:n,responsable_local:(null===e||void 0===e?void 0:e.responsable)||E.responsable_local||"",magasin:E.magasin||"Magasin",articles:E.articles.map((e=>({article:e.article,designation_article:e.designation_article,quantity:parseFloat(e.quantity)||0,quantite_mise_a_jour:e.quantite_mise_a_jour||0})))}),i=await fetch("".concat(M,"/controle/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",data:l})});if(!i.ok)throw new Error((await i.json()).error||"Erreur lors de l'ajout");S(!1),C({type_sortie:"OT",nature_sortie:"normal",magasin:"Magasin",articles:[]}),await Y()}else if("remove"===e&&f.size>0){const e=Array.from(f).map((e=>b[e].n_ot)),t=await fetch("".concat(M,"/controle/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remove",data:e})});if(!t.ok)throw new Error((await t.json()).error||"Erreur lors de la suppression");v(new Set),await Y()}}catch(a){_("\xc9chec de la mise \xe0 jour : ".concat(a.message)),console.error("[Controle] Erreur update:",a)}};return(0,p.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:(0,p.jsx)(h.Z,{title:"Contr\xf4le Livraison",children:(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 OT",value:x.nOt,onChange:e=>y((0,r.Z)((0,r.Z)({},x),{},{nOt:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full sm:w-48"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 BS",value:x.bs,onChange:e=>y((0,r.Z)((0,r.Z)({},x),{},{bs:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full sm:w-48"}),(0,p.jsxs)("select",{value:x.typeSortie,onChange:e=>y((0,r.Z)((0,r.Z)({},x),{},{typeSortie:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full sm:w-48",children:[(0,p.jsx)("option",{value:"",children:"Tous les types"}),Z.map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),j||N?(0,p.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[j&&(0,p.jsx)(l.Z,{color:"#3b82f6",size:20}),j&&(0,p.jsx)("span",{className:"text-gray-600",children:"Chargement des donn\xe9es..."}),N&&(0,p.jsxs)("span",{className:"text-red-600",children:["\u26a0\ufe0f ",N]})]}):null,(0,p.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,p.jsx)("button",{onClick:()=>S(!k),className:"px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-all duration-200 text-sm font-medium",disabled:j,children:k?"Annuler":"Ajouter"}),(0,p.jsx)("button",{onClick:()=>H("remove"),className:"px-4 py-2 bg-red-600 text-white rounded-lg shadow hover:bg-red-700 transition-all duration-200 text-sm font-medium",disabled:0===f.size||j,children:"Retirer"}),(0,p.jsx)("button",{onClick:()=>{const e=u.P6.json_to_sheet(b.map((e=>(0,r.Z)((0,r.Z)({},e),{},{articles:Array.isArray(e.articles)?e.articles.map((e=>"".concat(e.article," (").concat(e.quantity,")"))).join(", "):""})))),t=u.P6.json_to_sheet(L),a=u.P6.book_new();u.P6.book_append_sheet(a,e,"Controle Livraisons"),u.P6.book_append_sheet(a,t,"Stock Control"),u.NC(a,"controle_livraison_".concat(d()().format("YYYYMMDD_HHmmss"),".xlsx"))},className:"px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-all duration-200 text-sm font-medium",disabled:j,children:"Exporter Excel"}),(0,p.jsx)("button",{onClick:()=>{const e=window.open("","_blank"),t="\n      <html>\n        <head>\n          <title>Contr\xf4le Livraison - ".concat(d()().format("DD/MM/YYYY HH:mm"),"</title>\n          <style>\n            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n            body { font-family: 'Inter', sans-serif; margin: 20px; color: #1f2937; }\n            h1 { text-align: center; font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; }\n            h2 { font-size: 1.125rem; font-weight: 600; margin: 1.5rem 0 0.5rem; }\n            p { text-align: center; font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem; }\n            table { width: 100%; border-collapse: collapse; font-size: 0.75rem; margin-bottom: 1.25rem; }\n            th, td { border: 1px solid #e5e7eb; padding: 0.5rem; text-align: left; }\n            th { background-color: #f3f4f6; font-weight: 600; text-transform: uppercase; }\n            tr:nth-child(even) { background-color: #f9fafb; }\n            .no-data { text-align: center; padding: 1.25rem; font-style: italic; color: #6b7280; }\n            .validation-non-valide { color: #dc2626; font-weight: 600; }\n          </style>\n        </head>\n        <body>\n          <h1>Contr\xf4le Livraison</h1>\n          <p>Imprim\xe9 le ").concat(d()().format("DD/MM/YYYY HH:mm"),"</p>\n          <h2>Livraisons</h2>\n          <table>\n            <thead>\n              <tr>").concat(A.map((e=>"<th>".concat(e.header,"</th>"))).join(""),"</tr>\n            </thead>\n            <tbody>\n              ").concat(0===b.length?'<tr><td colspan="'.concat(A.length,'" class="no-data">Aucune donn\xe9e disponible pour les filtres s\xe9lectionn\xe9s.</td></tr>'):b.map((e=>"\n                      <tr>\n                        ".concat(A.map((t=>"\n                            <td>\n                              ".concat("articles"===t.key&&e[t.key]?Array.isArray(e.articles)?e.articles.map((e=>"".concat(e.article," (").concat(e.quantity,")"))).join(", "):"":void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:"","\n                            </td>\n                          "))).join(""),"\n                      </tr>\n                    "))).join(""),"\n            </tbody>\n          </table>\n          <h2>Stock Control</h2>\n          <table>\n            <thead>\n              <tr>").concat(T.map((e=>"<th>".concat(e.header,"</th>"))).join(""),"</tr>\n            </thead>\n            <tbody>\n              ").concat(0===L.length?'<tr><td colspan="'.concat(T.length,'" class="no-data">Aucun article disponible.</td></tr>'):L.map((e=>"\n                      <tr>\n                        ".concat(T.map((t=>'\n                            <td class="'.concat("validation"===t.key&&"Valid\xe9"!==e[t.key]?"validation-non-valide":"",'">\n                              ').concat(void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:"","\n                            </td>\n                          "))).join(""),"\n                      </tr>\n                    "))).join(""),"\n            </tbody>\n          </table>\n        </body>\n      </html>\n    ");e.document.write(t),e.document.close(),e.print()},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg shadow hover:bg-yellow-700 transition-all duration-200 text-sm font-medium",disabled:j,children:"Imprimer"})]}),k&&(0,p.jsxs)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3},className:"p-6 bg-white shadow-lg rounded-lg",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Ajouter une nouvelle livraison"}),(0,p.jsxs)("form",{onSubmit:e=>{e.preventDefault(),H("add")},className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type de sortie"}),(0,p.jsx)("select",{value:E.type_sortie,onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{type_sortie:e.target.value,n_ot:"",bs:"",le:"",commande_achat:""})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",children:Z.map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),"OT"===E.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 OT"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 OT",value:E.n_ot||"",onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{n_ot:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),"BS"===E.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 BS"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 BS",value:E.bs||"",onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{bs:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),"LE"===E.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 LE"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 LE",value:E.le||"",onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{le:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),"STO"===E.type_sortie&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 STO"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 STO",value:E.commande_achat||"",onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{commande_achat:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",required:!0})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nature de sortie"}),(0,p.jsx)("select",{value:E.nature_sortie,onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{nature_sortie:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",children:[{value:"urgent",label:"Urgent"},{value:"normal",label:"Normal"},{value:"session",label:"Session"}].map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xb0 R\xe9servation"}),(0,p.jsx)("input",{type:"text",placeholder:"N\xb0 R\xe9servation",value:E.n_reservation||"",onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{n_reservation:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin"}),(0,p.jsx)("select",{value:E.magasin,onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{magasin:e.target.value,local:"",responsable_local:""})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",children:[{value:"Magasin",label:"Magasin"},{value:"Magasin EPI",label:"Magasin EPI"},{value:"Parc Exterieur",label:"Parc Exterieur"}].map((e=>(0,p.jsxs)("option",{value:e.value,children:[e.label," - ",D[e.value]]},e.value)))})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Local"}),(0,p.jsxs)("select",{value:E.local,onChange:e=>{var t;const a=null===(t=q[E.magasin])||void 0===t?void 0:t.find((t=>t.value===e.target.value));C((0,r.Z)((0,r.Z)({},E),{},{local:e.target.value,responsable_local:(null===a||void 0===a?void 0:a.responsable)||""}))},className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full",disabled:!E.magasin,children:[(0,p.jsx)("option",{value:"",children:"S\xe9lectionner un local"}),E.magasin&&(null===(e=q[E.magasin])||void 0===e?void 0:e.map((e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value))))]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Demandeur"}),(0,p.jsx)("input",{type:"text",placeholder:"Demandeur",value:E.demandeur||"",onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{demandeur:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pr\xe9parateur"}),(0,p.jsx)("input",{type:"text",placeholder:"Pr\xe9parateur",value:E.preparateur||"",onChange:e=>C((0,r.Z)((0,r.Z)({},E),{},{preparateur:e.target.value})),className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsable local"}),(0,p.jsx)("input",{type:"text",placeholder:"Responsable local",value:E.responsable_local||"",readOnly:!0,className:"p-2.5 border border-gray-300 rounded-lg shadow-sm bg-gray-100 text-sm w-full"})]}),(0,p.jsxs)("div",{className:"col-span-1 sm:col-span-2",children:[(0,p.jsx)("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:"Ajouter des articles"}),(0,p.jsxs)("select",{onChange:e=>{const[t,a]=e.target.value.split(" - ");t&&a&&((e,t)=>{E.articles.some((t=>t.article===e))||C((a=>(0,r.Z)((0,r.Z)({},a),{},{articles:[...a.articles,{article:e,designation_article:t,quantity:0,quantite_mise_a_jour:0}]})))})(t,a),e.target.value=""},className:"p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-full mb-2",disabled:0===L.length,children:[(0,p.jsx)("option",{value:"",children:"S\xe9lectionner un article"}),L.length>0?[...new Set(L.map((e=>e.article)))].map((e=>{const t=L.find((t=>t.article===e));return(0,p.jsxs)("option",{value:"".concat(e," - ").concat(t.designation_article),children:[e," - ",t.designation_article," (Quantit\xe9 Contr\xf4le: ",t.stock_quantite_controle||0,")"]},e)})):(0,p.jsx)("option",{disabled:!0,children:"Aucun article disponible"})]}),E.articles.length>0&&(0,p.jsx)("div",{className:"mt-2 overflow-x-auto",children:(0,p.jsxs)("table",{className:"w-full text-sm border-collapse bg-white shadow-lg rounded-lg",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{className:"bg-gray-100",children:[(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Code"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"D\xe9signation"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Quantit\xe9 Contr\xf4le"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Quantit\xe9"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Quantit\xe9 Mise \xe0 Jour"}),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Actions"})]})}),(0,p.jsx)("tbody",{children:E.articles.map(((e,t)=>{const a=L.find((t=>t.article===e.article));return(0,p.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:e.article}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:e.designation_article}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(null===a||void 0===a?void 0:a.stock_quantite_controle)||0}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("input",{type:"number",min:"0",step:"1",value:e.quantity,onChange:e=>((e,t)=>{const a=[...E.articles],s=parseFloat(t)||0;if(s<0)return;const o=L.find((t=>t.article===a[e].article));o&&s>o.stock_quantite_controle?_("Quantit\xe9 pour ".concat(a[e].article," d\xe9passe la quantit\xe9 contr\xf4le (").concat(o.stock_quantite_controle,")")):(a[e].quantity=s,a[e].quantite_mise_a_jour=((null===o||void 0===o?void 0:o.stock_quantite_controle)||0)-s,C((e=>(0,r.Z)((0,r.Z)({},e),{},{articles:a}))))})(t,e.target.value),className:"p-1.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-20",placeholder:"Quantit\xe9"})}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:void 0!==e.quantite_mise_a_jour?e.quantite_mise_a_jour:0}),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("button",{type:"button",onClick:()=>(e=>{const t=[...E.articles];t.splice(e,1),C((e=>(0,r.Z)((0,r.Z)({},e),{},{articles:t})))})(t),className:"text-red-600 hover:text-red-700 transition-colors duration-200",children:(0,p.jsx)(i.Xm5,{className:"h-4 w-4"})})})]},e.article)}))})]})}),0===E.articles.length&&(0,p.jsx)("p",{className:"text-gray-600 text-sm italic",children:"Aucun article s\xe9lectionn\xe9."})]}),(0,p.jsx)("button",{type:"submit",className:"col-span-1 sm:col-span-2 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-all duration-200 text-sm font-medium",disabled:j||0===E.articles.length,children:"Ajouter la livraison"})]})]}),(0,p.jsxs)("div",{className:"mt-6",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Stock Control"}),(0,p.jsx)("div",{className:"overflow-x-auto bg-white shadow-lg rounded-lg",children:(0,p.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,p.jsx)("thead",{children:(0,p.jsx)("tr",{className:"bg-gray-100",children:T.map((e=>(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:e.header},e.key)))})}),(0,p.jsx)("tbody",{children:0===L.length?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:T.length,className:"border border-gray-200 p-2 text-center text-gray-600",children:"Aucun article disponible."})}):L.map(((e,t)=>(0,p.jsx)("tr",{className:"hover:bg-gray-50",children:T.map((t=>(0,p.jsx)("td",{className:"border border-gray-200 p-2 ".concat("validation"===t.key&&"Valid\xe9"!==e[t.key]?"text-red-600 font-semibold":""),children:void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:""},t.key)))},t)))})]})})]}),(0,p.jsxs)("div",{className:"mt-6",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Livraisons"}),(0,p.jsx)("div",{className:"overflow-x-auto bg-white shadow-lg rounded-lg",children:(0,p.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{className:"bg-gray-100",children:[(0,p.jsx)("th",{className:"border border-gray-200 p-2",children:(0,p.jsx)("input",{type:"checkbox",onChange:e=>v(e.target.checked?new Set(b.map(((e,t)=>t))):new Set),disabled:j})}),A.map((e=>(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:e.header},e.key))),(0,p.jsx)("th",{className:"border border-gray-200 p-2 text-left text-gray-700",children:"Actions"})]})}),(0,p.jsx)("tbody",{children:0===b.length?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:A.length+2,className:"border border-gray-200 p-2 text-center text-gray-600",children:"Aucune donn\xe9e disponible pour les filtres s\xe9lectionn\xe9s."})}):b.map(((e,t)=>(0,p.jsxs)("tr",{className:"".concat(f.has(t)?"bg-gray-50":""," hover:bg-gray-50"),children:[(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("input",{type:"checkbox",checked:f.has(t),onChange:()=>(e=>{const t=new Set(f);t.has(e)?t.delete(e):t.add(e),v(t)})(t),disabled:j})}),A.map((t=>(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:"articles"===t.key&&e[t.key]?Array.isArray(e.articles)?e.articles.map((e=>"".concat(e.article," (").concat(e.quantity,")"))).join(", "):"":void 0!==e[t.key]&&null!==e[t.key]?e[t.key]:""},t.key))),(0,p.jsx)("td",{className:"border border-gray-200 p-2",children:(0,p.jsx)("button",{onClick:()=>(async e=>{try{const t=b[e].n_ot,a=await fetch("".concat(M,"/controle/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remove",data:[t]})});if(!a.ok)throw new Error((await a.json()).error||"Erreur lors de la suppression");v(new Set),await Y()}catch(t){_("\xc9chec de la suppression : ".concat(t.message)),console.error("[Controle] Erreur delete:",t)}})(t),className:"text-red-600 hover:text-red-700 transition-colors duration-200",disabled:j,children:(0,p.jsx)(i.Xm5,{className:"h-4 w-4"})})})]},t)))})]})})]})]})})})}}}]);
//# sourceMappingURL=553.4bcb07a0.chunk.js.map