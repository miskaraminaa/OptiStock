"use strict";(self.webpackChunkadmin_dashboard_template_OptiStock=self.webpackChunkadmin_dashboard_template_OptiStock||[]).push([[380],{9380:(t,e,a)=>{a.r(e),a.d(e,{default:()=>f});var s=a(2791),o=a(9434),n=a(3623),r=a(8268),l=a(184);r.kL.register(r.jn,r.uw,r.f$,r.od,r.u,r.De);const i=t=>{let{startDate:e,endDate:a,article:o}=t;const[r,i]=(0,s.useState)({labels:[],datasets:[]}),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(!0),p="http://localhost:5000";return(0,s.useEffect)((()=>{e&&a?(async()=>{h(!0),d(null);try{const t=t=>t?"string"===typeof t?t:t.toISOString().split("T")[0]:null,s=t(e),n=t(a);if(!s||!n)throw new Error("Invalid date range provided");const r=new URL("".concat(p,"/charts/stock-over-time"));r.searchParams.append("startDate",s),r.searchParams.append("endDate",n),o&&r.searchParams.append("article",o),console.log("Fetching data from:",r.toString());const l=await fetch(r.toString());if(!l.ok){const t=await l.text();throw new Error("HTTP ".concat(l.status,": ").concat(t))}const c=await l.json();if(console.log("API Response:",c),!c.data||!Array.isArray(c.data))throw new Error("Invalid data format received from API");if(0===c.data.length)return i({labels:[],datasets:[{label:"Stock Quantity",data:[],borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",fill:!0,tension:.1}]}),void d("No data available for the selected date range");const u=c.data.map((t=>({date:new Date(t.date).toLocaleDateString(),total_quantity:parseFloat(t.total_quantity)||0}))),g={labels:u.map((t=>t.date)),datasets:[{label:o?"Stock for ".concat(o):"Total Stock Quantity",data:u.map((t=>t.total_quantity)),borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",fill:!0,tension:.1,pointRadius:3,pointHoverRadius:5}]};i(g),d(null)}catch(c){console.error("Error fetching LineChart data:",c),d("Failed to load data: ".concat(c.message)),i({labels:[],datasets:[]})}finally{h(!1)}})():(d("Please provide valid start and end dates"),h(!1))}),[e,a,o,p]),(0,l.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-lg h-80 flex flex-col",children:[" ",(0,l.jsxs)("h2",{className:"text-lg font-semibold mb-1 flex-shrink-0",children:[" ","Stock Levels Over Time",o&&(0,l.jsxs)("span",{className:"text-sm text-gray-600 ml-2",children:["(",o,")"]})]}),u?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-gray-500",children:"Loading..."})}):c?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-red-500 text-center",children:c})}):(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:(0,l.jsx)(n.x1,{data:r,options:{responsive:!0,maintainAspectRatio:!1,height:150,scales:{x:{title:{display:!0,text:"Date",font:{size:10}},ticks:{maxRotation:45,minRotation:45,font:{size:8}}},y:{title:{display:!0,text:"Quantity",font:{size:10}},beginAtZero:!0,ticks:{font:{size:8}}}},plugins:{legend:{position:"bottom",labels:{boxWidth:8,font:{size:10},padding:5}},tooltip:{callbacks:{label:t=>"".concat(t.dataset.label,": ").concat(t.parsed.y.toLocaleString()," units")}}},interaction:{intersect:!1,mode:"index"},layout:{padding:5}}})})]})};r.kL.register(r.ZL,r.uw,r.f$,r.u,r.De);const c=t=>{let{startDate:e,endDate:a,article:o}=t;const[r,i]=(0,s.useState)({labels:[],datasets:[]}),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(!0),p="http://localhost:5000";return(0,s.useEffect)((()=>{e&&a?(async()=>{h(!0),d(null);try{const t=t=>t?"string"===typeof t?t:t.toISOString().split("T")[0]:null,s=t(e),n=t(a);if(!s||!n)throw new Error("Invalid date range provided");const r=new URL("".concat(p,"/charts/input-vs-output"));r.searchParams.append("startDate",s),r.searchParams.append("endDate",n),o&&r.searchParams.append("article",o),console.log("[BarChart] Fetching:",r.toString());const l=await fetch(r.toString());if(!l.ok){const t=await l.text();throw new Error("HTTP ".concat(l.status,": ").concat(t))}const c=await l.json();if(console.log("[BarChart] Raw API response:",c),!c.data||!Array.isArray(c.data))throw new Error("Invalid data format received from API");if(0===c.data.length)return i({labels:[],datasets:[{label:"Input (Receipts)",data:[],backgroundColor:"rgba(54, 162, 235, 0.7)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"Output (Issues)",data:[],backgroundColor:"rgba(255, 99, 132, 0.7)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]}),void d("No data available for the selected date range");const u=c.data.map((t=>{let e="Unknown";if(t.date)try{const a=new Date(t.date);e=isNaN(a.getTime())?t.date:a.toLocaleDateString()}catch(a){console.warn("[BarChart] Date formatting error:",a),e=String(t.date)}return{date:e,input_quantity:parseFloat(t.input_quantity)||0,output_quantity:parseFloat(t.output_quantity)||0}})),g={labels:u.map((t=>t.date)),datasets:[{label:"Input (Receipts)",data:u.map((t=>t.input_quantity)),backgroundColor:"rgba(54, 162, 235, 0.7)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"Output (Issues)",data:u.map((t=>t.output_quantity)),backgroundColor:"rgba(255, 99, 132, 0.7)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]};i(g),d(null)}catch(c){console.error("[BarChart] Fetch error:",c),d("Failed to load data: ".concat(c.message)),i({labels:[],datasets:[]})}finally{h(!1)}})():(d("Please provide valid start and end dates"),h(!1))}),[e,a,o,p]),(0,l.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-lg h-48 flex flex-col",children:[" ",(0,l.jsxs)("h2",{className:"text-lg font-semibold mb-1 flex-shrink-0",children:[" ","Input vs Output Quantities",o&&(0,l.jsxs)("span",{className:"text-sm text-gray-600 ml-2",children:["(",o,")"]})]}),u?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-gray-500",children:"Loading..."})}):c?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-red-500 text-center",children:c})}):0===r.labels.length?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-gray-500",children:"No data available for the selected period"})}):(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:(0,l.jsx)(n.$Q,{data:r,options:{responsive:!0,maintainAspectRatio:!1,height:150,scales:{x:{title:{display:!0,text:"Date",font:{size:10}},ticks:{maxRotation:45,minRotation:45,font:{size:8}}},y:{title:{display:!0,text:"Quantity",font:{size:10}},beginAtZero:!0,ticks:{font:{size:8}}}},plugins:{legend:{position:"bottom",labels:{boxWidth:8,font:{size:10},padding:5}},tooltip:{callbacks:{label:t=>{const e=t.dataset.label.includes("Output")?" (Goods Issued)":" (Goods Received)";return"".concat(t.dataset.label,": ").concat(t.parsed.y.toLocaleString()," units").concat(e)}}}},interaction:{intersect:!1,mode:"index"},layout:{padding:5}}})})]})};r.kL.register(r.qi,r.u,r.De);const d=()=>{const[t,e]=(0,s.useState)({labels:[],datasets:[]}),[a,o]=(0,s.useState)(null),[r,i]=(0,s.useState)(!0),c="http://localhost:5000";return(0,s.useEffect)((()=>{(async()=>{i(!0);try{const t=await fetch("".concat(c,"/charts/division-distribution"));if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));const a=await t.json();if(!a.data||!Array.isArray(a.data))throw new Error("Invalid data format");const s={labels:a.data.map((t=>t.division||"Unknown")),datasets:[{data:a.data.map((t=>t.article_count||0)),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF"],borderWidth:1}]};e(s),o(null)}catch(a){console.error("Error fetching DoughnutChart data:",a),o("Failed to load data. Please check the API server.")}finally{i(!1)}})()}),[c]),(0,l.jsxs)("div",{className:"bg-white p-3 rounded-lg shadow-lg h-80 flex flex-col",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-2 flex-shrink-0",children:"Article Distribution by Division"}),r?(0,l.jsx)("p",{className:"text-gray-500 flex-1 flex items-center justify-center",children:"Loading..."}):a?(0,l.jsx)("p",{className:"text-red-500 flex-1 flex items-center justify-center",children:a}):(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:(0,l.jsx)(n.$I,{data:t,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:10,font:{size:10},padding:6,usePointStyle:!0},maxHeight:60},tooltip:{callbacks:{label:t=>"".concat(t.label,": ").concat(t.parsed," articles")}}},layout:{padding:{top:10,bottom:5,left:10,right:10}},cutout:"60%"}})})]})};r.kL.register(r.qi,r.u,r.De);const u=()=>{const[t,e]=(0,s.useState)({labels:[],datasets:[]}),[a,o]=(0,s.useState)(null),r="http://localhost:5000";return(0,s.useEffect)((()=>{(async()=>{try{const t=await fetch("".concat(r,"/charts/type-stock-distribution"));if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));const a=await t.json(),s={labels:a.data.map((t=>t.type_stock||"Unknown")),datasets:[{data:a.data.map((t=>t.article_count||0)),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0"],borderWidth:1}]};e(s),o(null)}catch(a){console.error("Error fetching PieChart data:",a),o("Failed to load data. Please try again.")}})()}),[r]),(0,l.jsxs)("div",{className:"bg-white p-3 rounded-lg shadow-lg h-80 flex flex-col",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-2 flex-shrink-0",children:"Article Distribution by Stock Type"}),a?(0,l.jsx)("p",{className:"text-red-500 flex-1 flex items-center justify-center",children:a}):(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:(0,l.jsx)(n.by,{data:t,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{boxWidth:12,font:{size:11},padding:8,usePointStyle:!0},maxWidth:120},tooltip:{callbacks:{label:t=>"".concat(t.label,": ").concat(t.parsed," articles")}}},layout:{padding:10}}})})]})};r.kL.register(r.od,r.f$,r.u,r.De);const h=()=>{const[t,e]=(0,s.useState)({datasets:[]}),[a,o]=(0,s.useState)(null),r="http://localhost:5000";return(0,s.useEffect)((()=>{(async()=>{try{const t=await fetch("".concat(r,"/charts/stock-vs-price"));if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));const a={datasets:[{label:"Stock vs Price",data:(await t.json()).data.map((t=>({x:t.quantite,y:t.prix}))),backgroundColor:"rgba(75, 192, 192, 0.6)",pointRadius:5}]};e(a),o(null)}catch(a){console.error("Error fetching ScatterChart data:",a),o("Failed to load data. Please try again.")}})()}),[r]),(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-lg h-80",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Stock vs Price"}),a?(0,l.jsx)("p",{className:"text-red-500",children:a}):(0,l.jsx)(n.bp,{data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Quantity"},beginAtZero:!0},y:{title:{display:!0,text:"Price"},beginAtZero:!0}},plugins:{legend:{position:"top",labels:{boxWidth:10,font:{size:12}}},tooltip:{callbacks:{label:t=>"Quantity: ".concat(t.raw.x,", Price: ").concat(t.raw.y)}}}}})]})};r.kL.register(r.ZL,r.uw,r.f$,r.u,r.De);const p=t=>{let{startDate:e,endDate:a,article:o}=t;const[r,i]=(0,s.useState)({labels:[],datasets:[]}),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(!0),p="http://localhost:5000";return(0,s.useEffect)((()=>{(async()=>{h(!0),d(null);try{const t=e instanceof Date?e:new Date(e),s=a instanceof Date?a:new Date(a);if(isNaN(t.getTime())||isNaN(s.getTime())||t>s)throw new Error("Invalid date range provided");const n=new URL("".concat(p,"/charts/movement-by-code"));n.searchParams.append("startDate",t.toISOString().split("T")[0]),n.searchParams.append("endDate",s.toISOString().split("T")[0]),o&&n.searchParams.append("article",o),console.log("[StackBarChart] Fetching from:",n.toString());const r=await fetch(n,{method:"GET"});if(!r.ok){const t=await r.text();throw console.log("[StackBarChart] Error response:",t),new Error("HTTP ".concat(r.status,": ").concat(t))}const l=await r.json();if(console.log("[StackBarChart] API Response:",l),!l.data||!Array.isArray(l.data))throw new Error("Invalid data format from API");const c={labels:l.data.map((t=>t.code_mouvement||"Unknown")),datasets:[{label:"Quantity by Movement Code",data:l.data.map((t=>t.total_quantity||0)),backgroundColor:l.data.map((t=>["101","531"].includes(t.code_mouvement)?"rgba(54, 162, 235, 0.7)":"rgba(255, 99, 132, 0.7)")),borderColor:l.data.map((t=>["101","531"].includes(t.code_mouvement)?"rgba(54, 162, 235, 1)":"rgba(255, 99, 132, 1)")),borderWidth:1}]};i(c),d(null)}catch(c){console.error("Error fetching StackBarChart data:",c),d("Failed to load data. Please try again. Details: ".concat(c.message))}finally{h(!1)}})()}),[e,a,o,p]),(0,l.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-lg h-48 flex flex-col",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-1",children:"Stock Movement by Code"}),u?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-gray-500",children:"Loading..."})}):c?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-red-500 text-center",children:c})}):(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:(0,l.jsx)(n.$Q,{data:r,options:{responsive:!0,maintainAspectRatio:!1,height:150,scales:{x:{title:{display:!0,text:"Movement Code",font:{size:10}},ticks:{font:{size:8}}},y:{title:{display:!0,text:"Quantity",font:{size:10}},beginAtZero:!0,ticks:{font:{size:8}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:t=>{const e=t.label,a=t.parsed.y,s=["201","261"].includes(e);return"Code ".concat(e,": ").concat(a," units ").concat(s?"(Goods Issued)":"(Goods Received)")}}}},layout:{padding:5}}})})]})};var g=a(4734);const m=function(){const[t,e]=(0,s.useState)({startDate:new Date("2025-01-01"),endDate:new Date("2025-04-31")}),[a,o]=(0,s.useState)([]),[n,r]=(0,s.useState)(""),[m,x]=(0,s.useState)(null),[f,b]=(0,s.useState)({totalStock:0,totalInput:0,totalOutput:0,uniqueArticles:0}),[y,w]=(0,s.useState)(!1),j="http://localhost:5000";return(0,s.useEffect)((()=>{(async()=>{try{console.log("[Charts] Fetching articles from:","".concat(j,"/charts/articles"));const t=await fetch("".concat(j,"/charts/articles"));if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));const e=await t.json();if(console.log("[Charts] Articles data:",JSON.stringify(e.data,null,2)),!e.data||!Array.isArray(e.data))throw new Error("Invalid article data");o(e.data),x(null)}catch(t){console.error("[Charts] Articles fetch error:",t),x("Failed to load articles. Please try again.")}})()}),[j]),(0,s.useEffect)((()=>{t.startDate&&t.endDate&&(async()=>{w(!0),x(null);try{var e,a;const s=null===(e=t.startDate)||void 0===e?void 0:e.toISOString().split("T")[0],o=null===(a=t.endDate)||void 0===a?void 0:a.toISOString().split("T")[0],[n,r,l,i]=await Promise.all([fetch("".concat(j,"/charts/total-stock?startDate=").concat(s,"&endDate=").concat(o)),fetch("".concat(j,"/charts/total-input?startDate=").concat(s,"&endDate=").concat(o)),fetch("".concat(j,"/charts/total-output?startDate=").concat(s,"&endDate=").concat(o)),fetch("".concat(j,"/charts/unique-articles"))]);if(!n.ok||!r.ok||!l.ok||!i.ok)throw new Error("HTTP error: ".concat(n.status||r.status||l.status||i.status));const[c,d,u,h]=await Promise.all([n.json(),r.json(),l.json(),i.json()]);console.log("[Charts] KPI Data:",{stockData:c,inputData:d,outputData:u,uniqueData:h}),b({totalStock:c.data||0,totalInput:d.data||0,totalOutput:u.data||0,uniqueArticles:h.data||0})}catch(s){console.error("[Charts] KPI fetch error:",s),x("Failed to load KPI data. Details: ".concat(s.message))}finally{w(!1)}})()}),[t,j]),(0,l.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Data Analysis Dashboard"}),(0,l.jsx)("div",{className:"mb-6 flex space-x-4 items-end",children:(0,l.jsx)(g.Z,{containerClassName:"w-72",value:t,theme:"light",inputClassName:"input input-bordered w-full",popoverDirection:"down",toggleClassName:"invisible",onChange:t=>{console.log("[Charts] Date changed to:",t),e({startDate:t.startDate?new Date(t.startDate):null,endDate:t.endDate?new Date(t.endDate):null})},showShortcuts:!0,primaryColor:"white"})}),(0,l.jsx)("div",{className:"mb-4",children:y?(0,l.jsx)("p",{className:"text-gray-500 text-center",children:"Loading KPIs..."}):m?(0,l.jsx)("p",{className:"text-red-500 text-center",children:m}):(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-lg text-center",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Total Stock"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:f.totalStock.toLocaleString()})]}),(0,l.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-lg text-center",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Total Input"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:f.totalInput.toLocaleString()})]}),(0,l.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-lg text-center",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Total Output"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:f.totalOutput.toLocaleString()})]}),(0,l.jsxs)("div",{className:"bg-white p-2 rounded-lg shadow-lg text-center",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Unique Articles"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:f.uniqueArticles.toLocaleString()})]})]})}),(0,l.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,l.jsx)(p,{startDate:t.startDate,endDate:t.endDate,article:n}),(0,l.jsx)(c,{startDate:t.startDate,endDate:t.endDate}),(0,l.jsx)(d,{}),(0,l.jsx)(u,{}),(0,l.jsx)(h,{}),(0,l.jsx)(i,{startDate:t.startDate,endDate:t.endDate})]})]})};var x=a(5054);const f=function(){const t=(0,o.I0)();return(0,s.useEffect)((()=>{t((0,x.Iw)({title:"Analytics"}))}),[]),(0,l.jsx)(m,{})}}}]);
//# sourceMappingURL=380.5cc46dd7.chunk.js.map