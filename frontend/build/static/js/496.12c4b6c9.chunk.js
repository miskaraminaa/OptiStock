"use strict";(self.webpackChunkadmin_dashboard_template_OptiStock=self.webpackChunkadmin_dashboard_template_OptiStock||[]).push([[496,870],{5870:(e,s,t)=>{t.r(s),t.d(s,{default:()=>d});var a=t(1413),l=t(2791),r=t(7848),o=t(4045),n=t(1989),i=t(7689),c=t(184);const d=()=>{var e;const[s,t]=(0,l.useState)([]),[d,m]=(0,l.useState)("LE"),[u,x]=(0,l.useState)(""),[h,p]=(0,l.useState)(null),[g,f]=(0,l.useState)([]),[j,y]=(0,l.useState)(!0),b=(0,i.s0)(),v="http://localhost:5000";(0,l.useEffect)((()=>{(async()=>{const e=localStorage.getItem("token");if(console.log("Token on mount:",e),!e)return x("No session found. Redirecting to login..."),setTimeout((()=>b("/login")),2e3),void y(!1);try{const s=await n.Z.get("".concat(v,"/auth/verify-token"),{headers:{Authorization:"Bearer ".concat(e)}});console.log("Verify token response:",s.data),y(!1)}catch(a){var s,t;console.error("Token verification error:",{message:a.message,status:null===(s=a.response)||void 0===s?void 0:s.status,data:null===(t=a.response)||void 0===t?void 0:t.data}),x("Invalid session. Redirecting to login..."),localStorage.removeItem("token"),setTimeout((()=>b("/login")),2e3),y(!1)}})()}),[b]);const N=(0,l.useCallback)((async e=>{const l=localStorage.getItem("token");if(console.log("Token on upload:",l),!l)return x("Please log in to upload files."),void b("/login");const r=s.map((e=>e.name)),i=e.filter((e=>!r.includes(e.name))).map((e=>({name:e.name,type:d,size:e.size,date:(new Date).toLocaleString(),fileObj:e,data:null})));if(0===i.length)return void x("All selected files are already imported!");x("Uploading...");const c=i.map((e=>new Promise(((s,t)=>{const a=new FileReader;a.onload=a=>{try{const t=new Uint8Array(a.target.result),l=o.ij(t,{type:"array"}),r=l.SheetNames[0],n=l.Sheets[r],i=o.P6.sheet_to_json(n,{header:1});e.data=i,s()}catch(l){t(new Error("Failed to read file ".concat(e.name,": ").concat(l.message)))}},a.onerror=()=>t(new Error("Error reading file ".concat(e.name))),a.readAsArrayBuffer(e.fileObj)}))));try{await Promise.all(c);const e=i.map((async e=>{const s=new FormData;s.append("file",e.fileObj),s.append("type",e.type);try{const t=await n.Z.post("".concat(v,"/uploads"),s,{headers:{Authorization:"Bearer ".concat(l),"Content-Type":"multipart/form-data"}});return console.log("Upload response:",t.data),(0,a.Z)((0,a.Z)({},e),{},{status:"success",backendData:t.data})}catch(d){var t,r,o,i,c;return console.error("Upload error:",{message:d.message,status:null===(t=d.response)||void 0===t?void 0:t.status,data:null===(r=d.response)||void 0===r?void 0:r.data}),401===(null===(o=d.response)||void 0===o?void 0:o.status)?(x("Session expired. Redirecting to login..."),localStorage.removeItem("token"),b("/login"),(0,a.Z)((0,a.Z)({},e),{},{status:"failed",error:"Unauthorized: Please log in again"})):(0,a.Z)((0,a.Z)({},e),{},{status:"failed",error:(null===(i=d.response)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.message)||"Upload failed"})}})),s=await Promise.all(e);t((e=>[...e,...s]));const r=s.every((e=>"success"===e.status)),o=s.every((e=>"failed"===e.status));x(r?"Upload successful!":o?"Upload failed for all files!":"Some files uploaded successfully, others failed.")}catch(m){x("Error processing files: ".concat(m.message))}}),[d,s,b]),{getRootProps:w,getInputProps:k,isDragActive:S}=(0,r.uI)({onDrop:N,accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"]}}),D=s.reduce(((e,s)=>(e[s.type]=e[s.type]||[],e[s.type].push(s),e)),{}),E=()=>{p(null),f([])};return j?(0,c.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,c.jsx)("p",{className:"text-xl text-gray-600",children:"Verifying session..."})}):(0,c.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-gray-100 min-h-screen",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"OptiStock File Upload"}),(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Select File Type"}),(0,c.jsx)("select",{value:d,onChange:e=>m(e.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:["LE","LET","LS","LST","MB51","MOUVEMENT","STOCK_EWM","ETAT_DE_STOCK"].map((e=>(0,c.jsx)("option",{value:e,children:e},e)))})]}),(0,c.jsxs)("div",(0,a.Z)((0,a.Z)({},w()),{},{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer ".concat(S?"border-indigo-500 bg-indigo-50":"border-gray-300"),children:[(0,c.jsx)("input",(0,a.Z)({},k())),(0,c.jsx)("p",{className:"text-gray-600",children:S?"Drop the Excel files here...":"Drag & drop Excel files here, or click to select"}),(0,c.jsx)("p",{className:"text-sm text-gray-500",children:"(.xlsx, .xls files only)"})]})),u&&(0,c.jsx)("p",{className:"mt-4 text-center ".concat(u.includes("successful")?"text-green-600":u.includes("failed")||u.includes("Error")?"text-red-600":"text-yellow-600"),children:u})]}),(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Uploaded Files"}),0===Object.keys(D).length?(0,c.jsx)("p",{className:"text-gray-500 text-center",children:"No files uploaded yet."}):Object.keys(D).map((e=>(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:["Type: ",e]}),(0,c.jsx)("ul",{className:"divide-y divide-gray-200",children:D[e].map(((e,s)=>(0,c.jsxs)("li",{className:"py-2 flex justify-between items-center",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-700",children:e.name}),e.status&&(0,c.jsxs)("span",{className:"ml-2 text-sm ".concat("success"===e.status?"text-green-600":"text-red-600"),children:["(","success"===e.status?"Uploaded":e.error,")"]})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:"text-gray-500 text-sm",children:[(e.size/1024).toFixed(2)," KB | ",e.date]}),(0,c.jsx)("button",{onClick:()=>(e=>{p(e),f(e.data||[])})(e),className:"ml-4 px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"View"})]})]},s)))})]},e)))]}),h&&(0,c.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",onClick:E,children:(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-3/4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["File Content: ",h.name]}),g.length>0&&(null===(e=g[0])||void 0===e?void 0:e.length)>0?(0,c.jsxs)("table",{className:"w-full border-collapse",children:[(0,c.jsx)("thead",{children:(0,c.jsx)("tr",{children:g[0].map(((e,s)=>(0,c.jsx)("th",{className:"border p-2 bg-gray-200",children:e},s)))})}),(0,c.jsx)("tbody",{children:g.slice(1).map(((e,s)=>(0,c.jsx)("tr",{children:e.map(((e,s)=>(0,c.jsx)("td",{className:"border p-2",children:e},s)))},s)))})]}):(0,c.jsx)("p",{className:"text-gray-500",children:"No valid content to display."}),"success"===h.status&&h.backendData&&(0,c.jsxs)("div",{className:"mt-4",children:[(0,c.jsx)("h4",{className:"text-md font-medium",children:"Backend Response:"}),(0,c.jsxs)("p",{children:["Successful Rows: ",h.backendData.summary.successfulRows]}),(0,c.jsxs)("p",{children:["Failed Rows: ",h.backendData.summary.failedRows]}),h.backendData.data.failureDetails.length>0&&(0,c.jsxs)("div",{children:[(0,c.jsx)("h5",{className:"text-sm font-medium",children:"Failure Details:"}),(0,c.jsx)("ul",{children:h.backendData.data.failureDetails.map(((e,s)=>(0,c.jsxs)("li",{className:"text-sm text-red-600",children:["Row ",e.rowIndex,": ",e.error]},s)))})]})]}),(0,c.jsx)("button",{onClick:E,className:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"Close"})]})})]})}},9496:(e,s,t)=>{t.r(s),t.d(s,{default:()=>c});var a=t(2791),l=t(9434),r=t(5054),o=t(5870),n=t(184);const i=function(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(o.default,{})})})};const c=function(){const e=(0,l.I0)();return(0,a.useEffect)((()=>{e((0,r.Iw)({title:"Dashboard"}))}),[]),(0,n.jsx)(i,{})}}}]);
//# sourceMappingURL=496.12c4b6c9.chunk.js.map