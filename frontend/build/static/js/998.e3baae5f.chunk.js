(self.webpackChunkadmin_dashboard_template_OptiStock=self.webpackChunkadmin_dashboard_template_OptiStock||[]).push([[998],{5870:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var a=t(1413),r=t(2791),l=t(7848),o=t(4045),n=t(1989),i=t(7689),c=t(184);const d=()=>{var e;const[s,t]=(0,r.useState)([]),[d,m]=(0,r.useState)("LE"),[u,p]=(0,r.useState)(""),[h,x]=(0,r.useState)(null),[g,f]=(0,r.useState)([]),[y,b]=(0,r.useState)(!0),v=(0,i.s0)(),j="http://localhost:5000";(0,r.useEffect)((()=>{(async()=>{const e=localStorage.getItem("token");if(console.log("Token on mount:",e),!e)return p("No session found. Redirecting to login..."),setTimeout((()=>v("/login")),2e3),void b(!1);try{const s=await n.Z.get("".concat(j,"/auth/verify-token"),{headers:{Authorization:"Bearer ".concat(e)}});console.log("Verify token response:",s.data),b(!1)}catch(a){var s,t;console.error("Token verification error:",{message:a.message,status:null===(s=a.response)||void 0===s?void 0:s.status,data:null===(t=a.response)||void 0===t?void 0:t.data}),p("Invalid session. Redirecting to login..."),localStorage.removeItem("token"),setTimeout((()=>v("/login")),2e3),b(!1)}})()}),[v]);const N=(0,r.useCallback)((async e=>{const r=localStorage.getItem("token");if(console.log("Token on upload:",r),!r)return p("Please log in to upload files."),void v("/login");const l=s.map((e=>e.name)),i=e.filter((e=>!l.includes(e.name))).map((e=>({name:e.name,type:d,size:e.size,date:(new Date).toLocaleString(),fileObj:e,data:null})));if(0===i.length)return void p("All selected files are already imported!");p("Uploading...");const c=i.map((e=>new Promise(((s,t)=>{const a=new FileReader;a.onload=a=>{try{const t=new Uint8Array(a.target.result),r=o.ij(t,{type:"array"}),l=r.SheetNames[0],n=r.Sheets[l],i=o.P6.sheet_to_json(n,{header:1});e.data=i,s()}catch(r){t(new Error("Failed to read file ".concat(e.name,": ").concat(r.message)))}},a.onerror=()=>t(new Error("Error reading file ".concat(e.name))),a.readAsArrayBuffer(e.fileObj)}))));try{await Promise.all(c);const e=i.map((async e=>{const s=new FormData;s.append("file",e.fileObj),s.append("type",e.type);try{const t=await n.Z.post("".concat(j,"/uploads"),s,{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"multipart/form-data"}});return console.log("Upload response:",t.data),(0,a.Z)((0,a.Z)({},e),{},{status:"success",backendData:t.data})}catch(d){var t,l,o,i,c;return console.error("Upload error:",{message:d.message,status:null===(t=d.response)||void 0===t?void 0:t.status,data:null===(l=d.response)||void 0===l?void 0:l.data}),401===(null===(o=d.response)||void 0===o?void 0:o.status)?(p("Session expired. Redirecting to login..."),localStorage.removeItem("token"),v("/login"),(0,a.Z)((0,a.Z)({},e),{},{status:"failed",error:"Unauthorized: Please log in again"})):(0,a.Z)((0,a.Z)({},e),{},{status:"failed",error:(null===(i=d.response)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.message)||"Upload failed"})}})),s=await Promise.all(e);t((e=>[...e,...s]));const l=s.every((e=>"success"===e.status)),o=s.every((e=>"failed"===e.status));p(l?"Upload successful!":o?"Upload failed for all files!":"Some files uploaded successfully, others failed.")}catch(m){p("Error processing files: ".concat(m.message))}}),[d,s,v]),{getRootProps:w,getInputProps:k,isDragActive:S}=(0,l.uI)({onDrop:N,accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"]}}),T=s.reduce(((e,s)=>(e[s.type]=e[s.type]||[],e[s.type].push(s),e)),{}),E=()=>{x(null),f([])};return y?(0,c.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,c.jsx)("p",{className:"text-xl text-gray-600",children:"Verifying session..."})}):(0,c.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-gray-100 min-h-screen",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"OptiStock File Upload"}),(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Select File Type"}),(0,c.jsx)("select",{value:d,onChange:e=>m(e.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:["LE","LET","LS","LST","MB51","MOUVEMENT","STOCK_EWM","ETAT_DE_STOCK"].map((e=>(0,c.jsx)("option",{value:e,children:e},e)))})]}),(0,c.jsxs)("div",(0,a.Z)((0,a.Z)({},w()),{},{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer ".concat(S?"border-indigo-500 bg-indigo-50":"border-gray-300"),children:[(0,c.jsx)("input",(0,a.Z)({},k())),(0,c.jsx)("p",{className:"text-gray-600",children:S?"Drop the Excel files here...":"Drag & drop Excel files here, or click to select"}),(0,c.jsx)("p",{className:"text-sm text-gray-500",children:"(.xlsx, .xls files only)"})]})),u&&(0,c.jsx)("p",{className:"mt-4 text-center ".concat(u.includes("successful")?"text-green-600":u.includes("failed")||u.includes("Error")?"text-red-600":"text-yellow-600"),children:u})]}),(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Uploaded Files"}),0===Object.keys(T).length?(0,c.jsx)("p",{className:"text-gray-500 text-center",children:"No files uploaded yet."}):Object.keys(T).map((e=>(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:["Type: ",e]}),(0,c.jsx)("ul",{className:"divide-y divide-gray-200",children:T[e].map(((e,s)=>(0,c.jsxs)("li",{className:"py-2 flex justify-between items-center",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-700",children:e.name}),e.status&&(0,c.jsxs)("span",{className:"ml-2 text-sm ".concat("success"===e.status?"text-green-600":"text-red-600"),children:["(","success"===e.status?"Uploaded":e.error,")"]})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:"text-gray-500 text-sm",children:[(e.size/1024).toFixed(2)," KB | ",e.date]}),(0,c.jsx)("button",{onClick:()=>(e=>{x(e),f(e.data||[])})(e),className:"ml-4 px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"View"})]})]},s)))})]},e)))]}),h&&(0,c.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",onClick:E,children:(0,c.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-3/4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["File Content: ",h.name]}),g.length>0&&(null===(e=g[0])||void 0===e?void 0:e.length)>0?(0,c.jsxs)("table",{className:"w-full border-collapse",children:[(0,c.jsx)("thead",{children:(0,c.jsx)("tr",{children:g[0].map(((e,s)=>(0,c.jsx)("th",{className:"border p-2 bg-gray-200",children:e},s)))})}),(0,c.jsx)("tbody",{children:g.slice(1).map(((e,s)=>(0,c.jsx)("tr",{children:e.map(((e,s)=>(0,c.jsx)("td",{className:"border p-2",children:e},s)))},s)))})]}):(0,c.jsx)("p",{className:"text-gray-500",children:"No valid content to display."}),"success"===h.status&&h.backendData&&(0,c.jsxs)("div",{className:"mt-4",children:[(0,c.jsx)("h4",{className:"text-md font-medium",children:"Backend Response:"}),(0,c.jsxs)("p",{children:["Successful Rows: ",h.backendData.summary.successfulRows]}),(0,c.jsxs)("p",{children:["Failed Rows: ",h.backendData.summary.failedRows]}),h.backendData.data.failureDetails.length>0&&(0,c.jsxs)("div",{children:[(0,c.jsx)("h5",{className:"text-sm font-medium",children:"Failure Details:"}),(0,c.jsx)("ul",{children:h.backendData.data.failureDetails.map(((e,s)=>(0,c.jsxs)("li",{className:"text-sm text-red-600",children:["Row ",e.rowIndex,": ",e.error]},s)))})]})]}),(0,c.jsx)("button",{onClick:E,className:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"Close"})]})})]})}},888:(e,s,t)=>{"use strict";var a=t(9047);function r(){}function l(){}l.resetWarningCache=r,e.exports=function(){function e(e,s,t,r,l,o){if(o!==a){var n=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw n.name="Invariant Violation",n}}function s(){return e}e.isRequired=e;var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:s,element:e,elementType:e,instanceOf:s,node:e,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:l,resetWarningCache:r};return t.PropTypes=t,t}},2007:(e,s,t)=>{e.exports=t(888)()},9047:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}}]);
//# sourceMappingURL=998.e3baae5f.chunk.js.map